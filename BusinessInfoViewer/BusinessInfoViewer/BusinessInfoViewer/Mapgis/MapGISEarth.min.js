function webSceneControl(e, t) {
    function i(e) {
        switch (e) {
            case"W".charCodeAt(0):
                return "moveDown";
            case"S".charCodeAt(0):
                return "moveUp";
            case"A".charCodeAt(0):
                return "moveRight";
            case"D".charCodeAt(0):
                return "moveLeft";
            case"Q".charCodeAt(0):
                return "rotateRight";
            case"E".charCodeAt(0):
                return "rotateLeft";
            case"Z".charCodeAt(0):
                return "goHome";
            case"G".charCodeAt(0):
                return "wireFrame";
            default:
                return
        }
    }

    function r(e) {
        u.innerHTML = e
    }



    this.root = Cesium;
    var o = !1, n = this.root.SceneMode.SCENE3D;
    void 0 != t && (1 == t.showInfo && (o = !0), "2D" == t.viewerMode ? n = this.root.SceneMode.SCENE2D : "COLUMBUS_VIEW" == t.viewerMode && (n = this.root.SceneMode.COLUMBUS_VIEW)), this.viewer = new this.root.Viewer(e, {
        animation: !1,
        baseLayerPicker: !1,
        timeline: !0,
        geocoder: !0,
        homeButton: !1,
        infoBox: !0,
        sceneModePicker: !1,
        selectionIndicator: !0,
        navigationHelpButton: !1,
        scene3DOnly: !1,
        selectedImageryProviderViewModel: void 0,
        vrButton: !1,
        fullscreenButton: !1,
        showRenderLoopErrors: !1,
        sceneMode: n,
        shadows: !0,
        fog: !1,
        dataSources: new this.root.DataSourceCollection
    }), this.keyEventEnable = !1, this.scene = this.viewer.scene;
    var a = this.viewer, s = this.scene;
    this.layers = a.imageryLayers, this.screenSpaceEventHandler = new this.root.ScreenSpaceEventHandler(a.scene.canvas);
    var l = this;
    a.cesiumWidget.screenSpaceEventHandler.removeInputAction(this.root.ScreenSpaceEventType.LEFT_DOUBLE_CLICK), this.showPosition = function (e) {
        if (void 0 != e) {
            var t = this.scene.globe.ellipsoid, i = this.viewer.entities.add({
                label: {
                    show: !1,
                    font: "14pt 宋体"
                }
            }), r = null, o = null, n = null, s = null, c = null, h = new this.root.ScreenSpaceEventHandler(this.scene.canvas);
            h.setInputAction(function (h) {
                if (l.scene.mode == l.root.SceneMode.SCENE3D) {
                    var u = a.camera.getPickRay(h.endPosition);
                    s = l.viewer.scene.globe.pick(u, a.scene)
                } else l.scene.mode == l.root.SceneMode.COLUMBUS_VIEW && (s = l.viewer.camera.pickEllipsoid(h.endPosition, t));
                if (s) {
                    var d = t.cartesianToCartographic(s);
                    r = l.root.Math.toDegrees(d.longitude), o = l.root.Math.toDegrees(d.latitude), n = Math.ceil(a.camera.positionCartographic.height), c = l.viewer.scene.globe.getHeight(d);
                    l.viewer.camera.heading, l.viewer.camera.pitch, l.viewer.camera.roll;
                    void 0 == c && (c = 0), document.getElementById(e).innerHTML = "经度:" + r.toFixed(4) + "°，纬度:" + o.toFixed(4) + "°，海拔高度:" + c.toFixed(0) + "米，相机视角高度:" + n.toFixed(0) + "米"
                } else i.label.show = !1
            }, this.root.ScreenSpaceEventType.MOUSE_MOVE)
        }
    };
    var c = this.scene.globe.ellipsoid;

    //todo 点击事件的函数，鼠标点击点后显示信息
    this.viewer.canvas.onclick = function () {
        this.focus();
    };
    var h = {
        looking: !1,
        rotateLeft: !1,
        rotateRight: !1,
        moveUp: !1,
        moveDown: !1,
        moveLeft: !1,
        moveRight: !1,
        goHome: !1,
        wireFrame: !1
    };
    new this.root.ScreenSpaceEventHandler(this.viewer.canvas);
    document.addEventListener("keydown", function (e) {
        var t = i(e.keyCode);
        "undefined" != typeof t && (h[t] = !0)
    }, !1), document.addEventListener("keyup", function (e) {
        var t = i(e.keyCode);
        "undefined" != typeof t && (h[t] = !1)
    }, !1), this.viewer.clock.onTick.addEventListener(function (e) {
        if (l.keyEventEnable) {
            var t = l.viewer.camera.position, i = c.cartesianToCartographic(t).height, r = i / 20;
            if (h.rotateLeft && l.viewer.camera.rotateLeft(.01), h.rotateRight && l.viewer.camera.rotateRight(.01), h.moveUp && l.viewer.camera.moveBackward(r), h.moveDown && l.viewer.camera.moveForward(r), h.moveLeft && l.viewer.camera.moveLeft(r), h.moveRight && l.viewer.camera.moveRight(r), h.goHome && l.viewer.camera.flyTo({destination: l.root.Cartesian3.fromDegrees(104, 30, 15682725)}), h.wireFrame) {
                var o = l.viewer.scene.globe._surface.tileProvider._debug.wireframe;
                l.viewer.scene.globe._surface.tileProvider._debug.wireframe = !o, h.wireFrame = !1
            }
        }
    }), this.cartesiansToCartographics = function (e) {
        var t = [];
        if (e)for (var i = 0; i < e.length; i++)t[i] = this.scene.globe.ellipsoid.cartesianToCartographic(e[i]), t[i].longitude = this.root.Math.toDegrees(t[i].longitude), t[i].latitude = this.root.Math.toDegrees(t[i].latitude);
        return t
    }, this.createDrawHelper = function (e) {
        var t = new DrawElement(this.viewer), i = t.addToolbar(document.getElementById(e), {buttons: ["marker", "polyline", "polygon", "circle", "extent"]}), o = Cesium.Material.fromType(Cesium.Material.ColorType);
        return o.uniforms.color = new Cesium.Color(1, 1, 0, .5), i.addListener("markerCreated", function (e) {
            r("标记将创建在： " + e.position.toString());
            var t = new this.root.BillboardCollection;
            s.primitives.add(t);
            var i = t.add({
                show: !0,
                position: e.position,
                pixelOffset: new l.root.Cartesian2(0, 0),
                eyeOffset: new l.root.Cartesian3(0, 0, 0),
                horizontalOrigin: l.root.HorizontalOrigin.CENTER,
                verticalOrigin: l.root.VerticalOrigin.CENTER,
                scale: 1,
                image: "./img/glyphicons_242_google_maps.png",
                color: new this.root.Color(1, 1, 1, 1)
            });
            i.setEditable()
        }), i.addListener("polylineCreated", function (e) {
            r("线： " + e.positions.length + " points");
            var t = new DrawElement.PolylinePrimitive({positions: e.positions, width: 5, geodesic: !0});
            s.primitives.add(t), t.setEditable(), t.addListener("onEdited", function (e) {
                r("Polyline edited, " + e.positions.length + " points")
            })
        }), i.addListener("polygonCreated", function (e) {
            r("区" + e.positions.length + " points");
            var t = new DrawElement.PolygonPrimitive({positions: e.positions, material: o});
            s.primitives.add(t), t.setEditable(), t.addListener("onEdited", function (e) {
                r("区编辑, " + e.positions.length + " 点")
            })
        }), i.addListener("circleCreated", function (e) {
            r("创建圆: 中心为" + e.center.toString() + " 半径为 " + e.radius.toFixed(1) + " meters");
            var t = new DrawElement.CirclePrimitive({
                center: e.center,
                radius: e.radius,
                material: l.root.Material.fromType(l.root.Material.RimLightingType)
            });
            s.primitives.add(t), t.setEditable(), t.addListener("onEdited", function (e) {
                r("以半径为 " + e.radius.toFixed(1) + " 米创建圆")
            })
        }), i.addListener("extentCreated", function (e) {
            var t = e.extent;
            r("Extent created (N: " + t.north.toFixed(3) + ", E: " + t.east.toFixed(3) + ", S: " + t.south.toFixed(3) + ", W: " + t.west.toFixed(3) + ")");
            var i = new DrawElement.ExtentPrimitive({
                extent: t,
                material: l.root.Material.fromType(l.root.Material.StripeType)
            });
            s.primitives.add(i), i.setEditable(), i.addListener("onEdited", function (e) {
                r("Extent edited: extent is (N: " + e.extent.north.toFixed(3) + ", E: " + e.extent.east.toFixed(3) + ", S: " + e.extent.south.toFixed(3) + ", W: " + e.extent.west.toFixed(3) + ")")
            })
        }), t
    };
    var u = document.getElementById("coordinate_height");
    this.flyTo = function (e, t, i, r) {
        if (null == i || "" == i || void 0 == i) {
            var o = Math.ceil(this.viewer.camera.positionCartographic.height);
            i = o
        }
        this.viewer.camera.flyTo({
            destination: this.root.Cartesian3.fromDegrees(e, t, i),
            duration: r,
            orientation: {
                heading: this.root.Math.toRadians(0),
                pitch: this.root.Math.toRadians(-90),
                roll: this.root.Math.toRadians(0)
            }
        })
    }, this.flyToEx = function (e, t, i) {
        var r, o, n, a, s = null;
        if (i ? (s = this.root.defaultValue(i.height, void 0), r = this.root.Math.toRadians(this.root.defaultValue(i.heading, this.root.Math.toRadians(0))), o = this.root.Math.toRadians(this.root.defaultValue(i.pitch, this.root.Math.toRadians(-90))), n = this.root.Math.toRadians(this.root.defaultValue(i.roll, this.root.Math.toRadians(0))), a = this.root.defaultValue(i.duration, 1)) : (r = this.root.Math.toRadians(0), o = this.root.Math.toRadians(-90), n = this.root.Math.toRadians(0), a = 1), null == s || "" == s || void 0 == s) {
            var l = Math.ceil(this.viewer.camera.positionCartographic.height);
            s = l
        }
        this.viewer.camera.flyTo({
            destination: this.root.Cartesian3.fromDegrees(e, t, s),
            duration: a,
            orientation: {heading: r, pitch: o, roll: n}
        })
    }, this.appendModel = function (e, t, i, r, o, n) {
        var a = this.root.Cartesian3.fromDegrees(i, r, o), s = Cesium.Math.toRadians(-90), l = 0, c = 0, h = Cesium.Transforms.headingPitchRollQuaternion(a, s, l, c), u = this.viewer.entities.add({
            name: t,
            position: a,
            orientation: h,
            model: {uri: t, minimumPixelSize: 256, maximumScale: n}
        });
        return u
    }, this.appendModelsByFile = function (e) {
        var t = new this.root.CzmlDataSource;
        return t.load(e), this.viewer.dataSources.add(t), t
    }, this.appendModels = function (e) {
        var t = new this.root.CzmlDataSource;
        return t.load(e), this.viewer.dataSources.add(t), t
    }, this.appendWMTSTile = function (e, t, i, r, o, n) {
        var a, s = "";
        "" != o && (s = new this.root.DefaultProxy(o)), a = "GoogleMapsCompatible_GB" == i ? new this.root.WebMercatorTilingScheme({
            numberOfLevelZeroTilesX: 1,
            numberOfLevelZeroTilesY: 1,
            rectangleSouthwestInMeters: new this.root.Cartesian2((-20037508.342789244), (-20037508.342789244)),
            rectangleNortheastInMeters: new this.root.Cartesian2(20037508.342789244, 20037508.342789244)
        }) : new this.root.GeographicTilingScheme({
            rectangle: this.root.Rectangle.fromDegrees(-180, -90, 180, 90),
            numberOfLevelZeroTilesX: 2,
            numberOfLevelZeroTilesY: 1
        }), this.viewer.imageryLayers.addImageryProvider(new this.root.WebMapTileServiceImageryProvider({
            url: e,
            layer: t,
            style: n,
            format: "image/png",
            tileMatrixSetID: i,
            maximumLevel: r,
            credit: new this.root.Credit("MapGIS"),
            tilingScheme: a,
            proxy: s
        }))
    }, this.appendTerrain = function (e, t, i, r, o) {
        var n = new this.root.CesiumTerrainProvider({
            url: e,
            tilingScheme: new this.root.GeographicTilingScheme({
                rectangle: this.root.Rectangle.fromDegrees(t, i, r, o),
                numberOfLevelZeroTilesX: 2,
                numberOfLevelZeroTilesY: 1
            }),
            requestVertexNormals: !0
        });
        this.viewer.terrainProvider = n
    }, this.appendMapGISTerrain = function (e, t, i, r) {
        var o = void 0;
        void 0 !== r && (o = new webSS.root.DefaultProxy(r));
        var n = e + "/GetTerrain?sceneIndex=" + t + "&layerIndex=" + i + "&Level={z}&Row={x}&Col={y}&xdensity=65&ydensity=65&webGL=true", a = new this.root.MapGISTerrainProvider({
            url: n,
            proxy: o
        });
        return this.viewer.terrainProvider = a, a
    }, this.appendMapGISTile = function (e, t) {
        var i = e + "/{level}/{row}/{col}", r = a.imageryLayers.addImageryProvider(new MapGISMapImageProvider({
            url: i,
            rectangle: t.tileRange,
            colNum: t.colNum,
            rowNum: t.rowNum,
            maximumLevel: t.maxLevel,
            proxy: new this.root.DefaultProxy(t.proxy)
        }));
        return r
    }, this.appendDocTile = function (e, t, i, r) {
        var o = e + "/GetCovering?sceneIndex=" + t.toString() + "&layerIndex=" + i.toString() + "&level={level}&row={row}&col={col}&xDensity=43&yDensity=43", n = a.imageryLayers.addImageryProvider(new MapGISDocMapProvider({
            url: o,
            rectangle: r.tileRange,
            colNum: r.colNum,
            rowNum: r.rowNum,
            maximumLevel: r.maxLevel,
            proxy: new this.root.DefaultProxy(r.proxy)
        }));
        return n
    }, this.appendImageByUrl = function (e, t, i, r, o) {
        var n = a.imageryLayers.addImageryProvider(new this.root.SingleTileImageryProvider({
            url: e,
            rectangle: this.root.Rectangle.fromDegrees(t, i, r, o)
        }));
        return n
    }, this.appendTileMapServiceImage = function (e, t) {
        var i = new this.root.UrlTemplateImageryProvider({
            url: e,
            maximumLevel: 8
        }), r = a.imageryLayers.addImageryProvider(i);
        return r
    }, this.appendCZML = function (e) {
        var t = this.root.CzmlDataSource.load(e);
        return this.viewer.dataSources.add(t), this.viewer.flyTo(t), t
    }, this.appendKml = function (e, t) {
        var i = new this.root.KmlDataSource;
        return i.load(e, t).then(function (e) {
            this.viewer.clock.multiplier = 1, this.viewer.clock.shouldAnimate = !0
        }), this.viewer.dataSources.add(i), i
    }, this.appendGoogleMap = function (e) {
        var t = "http://mt{s}.google.cn/vt/{type}&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s=Galileo";
        t = t.replace("{type}", e);
        var i = a.imageryLayers.addImageryProvider(new GoogleMapImageProvider({url: t}));
        return i
    }, this.appendPoint = function (e, t, i, r, o, n, s, l, c) {
        var h = a.entities.add({
            name: r,
            position: this.root.Cartesian3.fromDegrees(e, t, i),
            point: {pixelSize: o, color: n, outlineColor: s, outlineWidth: l},
            description: c
        });
        return h
    }, this.appendLabel = function (e, t, i, r, o) {
        lFont = this.root.defaultValue(o.font, "14pt monospace"), lFillColor = this.root.defaultValue(o.fillColor, this.root.Color.WHITE), lOutlineColor = this.root.defaultValue(o.outlineColor, this.root.Color.WHITE), lStyle = this.root.defaultValue(o.style, this.root.LabelStyle.FILL_AND_OUTLINE), lOutlineWidth = this.root.defaultValue(o.outlineWidth, 1), lVerticalOrigin = this.root.defaultValue(o.verticalOrigin, this.root.VerticalOrigin.CENTER), lHorizontalOrigin = this.root.defaultValue(o.horizontalOrigin, this.root.HorizontalOrigin.CENTER), lPixelOffset = this.root.defaultValue(o.pixelOffset, new this.root.Cartesian2(0, 0)), lScaleByDistance = this.root.defaultValue(o.scaleByDistance, new this.root.NearFarScalar(150, 3, 15e6, .5)), lTransparentByDistance = this.root.defaultValue(o.transparentByDistance, new this.root.NearFarScalar(15e4, 1, 15e6, 0)), lHeightReference = this.root.defaultValue(o.heightReference, this.root.HeightReference.CLAMP_TO_GROUND);
        var n = this.viewer.entities.add({
            name: "标签",
            position: this.root.Cartesian3.fromDegrees(e, t, i),
            label: {
                text: r,
                font: lFont,
                fillColor: lFillColor,
                style: lStyle,
                outlineWidth: lOutlineWidth,
                outlineColor: lOutlineColor,
                verticalOrigin: lVerticalOrigin,
                horizontalOrigin: lHorizontalOrigin,
                pixelOffset: lPixelOffset,
                heightReference: lHeightReference,
                pixelOffset: lPixelOffset,
                pixelOffsetScaleByDistance: lScaleByDistance,
                translucencyByDistance: lTransparentByDistance
            },
            description: o.description
        });
        return n
    }, this.appendBillboard = function (e, t, i, r, o, n, s) {
        var l = a.entities.add({
            name: r,
            position: this.root.Cartesian3.fromDegrees(e, t, i),
            billboard: {
                image: o,
                width: n,
                height: s,
                heightReference: this.root.HeightReference.CLAMP_TO_GROUND,
                pixelOffsetScaleByDistance: new this.root.NearFarScalar(150, 3, 15e6, .5),
                translucencyByDistance: new this.root.NearFarScalar(15e4, 1, 15e6, 0),
                verticalOrigin: this.root.VerticalOrigin.BOTTOM
            },
            description: "这是一个公告板的描述"
        });
        return l
    }, this.appendLabelIcon = function (e, t, i, r, o, n, s, l, c, h, u, d, p) {
        d = void 0 == d ? this.root.VerticalOrigin.BOTTOM : "center" == d ? this.root.VerticalOrigin.CENTER : "top" == d ? this.root.VerticalOrigin.TOP : this.root.VerticalOrigin.BOTTOM;
        var m = a.entities.add({
            name: e,
            position: this.root.Cartesian3.fromDegrees(t, i, r),
            billboard: {
                image: s,
                width: l,
                height: c,
                pixelOffsetScaleByDistance: new this.root.NearFarScalar(15e4, 3, 15e6, .5),
                translucencyByDistance: new this.root.NearFarScalar(15e4, 1, 15e6, 0),
                horizontalOrigin: this.root.HorizontalOrigin.TOP
            },
            label: {
                text: e,
                font: o,
                style: this.root.LabelStyle.FILL_AND_OUTLINE,
                fillColor: n,
                outlineWidth: 1,
                verticalOrigin: this.root.VerticalOrigin.BOTTOM,
                horizontalOrigin: this.root.HorizontalOrigin.BOTTOM,
                pixelOffset: new this.root.Cartesian2(0, -c / 4),
                pixelOffsetScaleByDistance: new this.root.NearFarScalar(150, 3, 15e6, .5),
                translucencyByDistance: new this.root.NearFarScalar(15e4, 1, 15e6, 0)
            },
            description: p
        });
        return m
    }, this.setView = function (e, t, i, r, o, n) {
        this.viewer.camera.setView({
            position: this.root.Cartesian3.fromDegrees(e, t, i),
            heading: this.root.Math.toRadians(r),
            pitch: this.root.Math.toRadians(o),
            roll: this.root.Math.toRadians(n)
        })
    }, this.icrf = function (e, t) {
        if (e.mode === this.root.SceneMode.SCENE3D) {
            var i = this.root.Transforms.computeIcrfToFixedMatrix(t);
            if (this.root.defined(i)) {
                var r = this.viewer.camera, o = this.root.Cartesian3.clone(this.viewer.camera.position), n = this.root.Matrix4.fromRotationTranslation(i);
                r.lookAtTransform(n, o)
            }
        }
    }, this.openRotation = function () {
        this.viewer.camera.flyHome(0);
        this.viewer.clock.multiplier;
        this.viewer.clock.multiplier = 10800, this.scene.preRender.addEventListener(this.icrf), this.scene.globe.enableLighting = !0
    }, this.closeRotation = function () {
        icrf = this.scene.preRender.removeEventListener(this.icrf), this.viewer.clock.multiplier = 1
    }, this.goHome = function () {
        a.camera.flyTo({destination: this.root.Cartesian3.fromDegrees(104, 30, 15682725)})
    }, this.changeSceneMode = function (e) {
        "3D" == e ? (this.scene.mode = this.root.SceneMode.SCENE3D, this.goHome()) : "COLUMBUS_VIEW" == e ? this.viewer.scene.morphToColumbusView(1) : this.viewer.scene.morphTo2D(1)
    }, this.zoomOut = function () {
        var e = c.cartesianToCartographic(this.viewer.camera.position).height;
        this.viewer.camera.zoomOut(e / 10)
    }, this.zoomIn = function () {
        var e = c.cartesianToCartographic(this.viewer.camera.position).height;
        this.viewer.camera.zoomIn(e / 10)
    }, this.calculatePositionSamples = function (e, t, i) {
        if (void 0 != e && e.constructor == Array) {
            for (var r = new this.root.SampledPositionProperty, o = 0; o < e.length; o++)r.addSample(this.root.JulianDate.addSeconds(t, i * o, new this.root.JulianDate), this.root.Cartesian3.fromDegrees(e[o][0], e[o][1]));
            return r
        }
    }, this.getColor = function (e, t, i, r) {
        return new this.root.Color(e, t, i, r)
    }, this.drawPolygon = function (e, t, i, r) {
        void 0 == i && (i = this.root.Color.WHITE.withAlpha(.5)), void 0 == r && (r = this.root.Color.RED.withAlpha(.5));
        var o = this.viewer.entities.add({
            name: e,
            polygon: {
                hierarchy: this.root.Cartesian3.fromDegreesArray(t),
                material: i,
                outline: !0,
                outlineColor: r,
                outlineWidth: 20
            }
        });
        return o
    }, this.drawLine = function (e, t, i, r) {
        void 0 == r && (r = this.root.Color.BLUE);
        var o = this.viewer.entities.add({
            name: e,
            polyline: {positions: this.root.Cartesian3.fromDegreesArray(t), width: i, material: r}
        });
        return o
    }, this.removeAllEntities = function () {
        this.viewer.entities.removeAll()
    }, this.removeEntity = function (e) {
        this.viewer.entities.remove(e)
    }, this.removeImageryLayer = function (e) {
        this.viewer.imageryLayers.remove(e)
    }, this.removeModel = function (e) {
        this.viewer.entities.remove(e)
    }, this.removeModels = function (e) {
        this.viewer.dataSources.remove(e)
    }, this.removeAllPrimitives = function () {
        this.scene.primitives.removeAll()
    }, this.registerMouseEvent = function (e, t) {
        var i;
        return "LEFT_CLICK" == e ? i = this.screenSpaceEventHandler.setInputAction(function (e) {
            "function" == typeof t && t(e)
        }, l.root.ScreenSpaceEventType.LEFT_CLICK) : "RIGHT_CLICK" == e ? i = this.screenSpaceEventHandler.setInputAction(function (e) {
            "function" == typeof t && t(e)
        }, l.root.ScreenSpaceEventType.RIGHT_CLICK) : "MOUSE_MOVE" == e ? i = this.screenSpaceEventHandler.setInputAction(function (e) {
            "function" == typeof t && t(e)
        }, l.root.ScreenSpaceEventType.MOUSE_MOVE) : "LEFT_DOUBLE_CLICK" == eventTYpe && (i = this.screenSpaceEventHandler.setInputAction(function (e) {
            "function" == typeof t && t(e)
        }, l.root.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)), i
    }, this.unRegisterMouseEvent = function (e) {
        "LEFT_CLICK" == e ? this.screenSpaceEventHandler.removeInputAction(l.root.ScreenSpaceEventType.LEFT_CLICK) : "RIGHT_CLICK" == e ? this.screenSpaceEventHandler.removeInputAction(l.root.ScreenSpaceEventType.RIGHT_CLICK) : "MOUSE_MOVE" == e ? this.screenSpaceEventHandler.removeInputAction(l.root.ScreenSpaceEventType.MOUSE_MOVE) : "LEFT_DOUBLE_CLICK" == eventTYpe && this.screenSpaceEventHandler.removeInputAction(l.root.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)
    }, this.outImage = function () {
        this.viewer.render(), ReImg.fromCanvas(this.viewer.canvas).downloadPng()
    }, this.screenPositionToCartographic = function (e) {
        var t, i;
        if (e) {
            if (this.scene.mode == this.root.SceneMode.SCENE3D) {
                var r = a.camera.getPickRay(e);
                t = this.viewer.scene.globe.pick(r, a.scene)
            } else this.scene.mode == this.root.SceneMode.COLUMBUS_VIEW && (t = this.viewer.camera.pickEllipsoid(e, this.scene.globe.ellipsoid));
            t && (i = this.scene.globe.ellipsoid.cartesianToCartographic(t))
        }
        return i
    }, this.screenPositionToCartesian = function (e) {
        var t;
        return e && (t = this.viewer.camera.pickEllipsoid(e, this.scene.globe.ellipsoid)), t
    }, this.radiansToDegrees = function (e) {
    }, this.getHeightFromDegrees = function (e, t) {
        var i, r = 0;
        return e && t && (i = this.root.Cartographic.fromDegrees(e, t), r = this.viewer.scene.globe.getHeight(i)), r
    }
}
function Measure(e, t) {
    function i(e) {
        return e.longitude = e.longitude / Math.PI * 180, e.latitude = e.latitude / Math.PI * 180, e
    }

    function r(e, t) {
        return e.z && t.z ? Math.sqrt((e.x - t.x) * (e.x - t.x) + (e.y - t.y) * (e.y - t.y) + (e.z - t.z) * (e.z - t.z)) : Math.sqrt((e.x - t.x) * (e.x - t.x) + (e.y - t.y) * (e.y - t.y))
    }

    function o(e, t) {
        e = l.cartesianToCartographic(e), e = i(e), t = l.cartesianToCartographic(t), t = i(t);
        var o = (e.longitude + t.longitude) / 2;
        return e = GASProjection.Gauss_to_XY(e.longitude, e.latitude, o), t = GASProjection.Gauss_to_XY(t.longitude, t.latitude, o), r(e, t)
    }

    function n(e) {
        for (var t = 0, i = 0; i < e.length - 1; i++)t += o(e[i], e[i + 1]);
        return t
    }

    var a = e.viewer, s = e.root, l = a.scene.globe.ellipsoid, c = null, h = new Array, u = null, d = null, p = 2, m = !0, g = !1;
    this._entityCollection = [];
    that = this;
    var f, v = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAATJQTFRF/fz8zgAA6wAAywAA+gEBvAAA+ff44SAg6QAAyBcX+/r6ghER/Pj4wQAApD4+hBMVpkND1cDHezdH3AAA2QAAmA4NxqSqfSIwwj4+/v7++/b2jEpb+Pf35BsbiVVdcQ4R7uzt39jY2tndv0JCgCIpliEm7AwMm21/8PDx9fT02gYG9fP0gRwkqXqB+fLygVpwxaqyyQ4OqYWW+AAA4+DgybW14tfXyAAA+fX2xcTKwgQEdi5FrEJCpqCp+vr6gzlKfxkdvZyc4Nra7Orq49DRvlZWgBQVsSsrsIGG6tvdzpKSuwAAuQAAigUDqTw86+rq+vr8hRUZ1xoa8AAAuAsL1gAAmI2bygAAoZ2nvI2NyxgY+fn50LvEdgoKnl9lthkZeiw24d3d+QAAwJSU/wAA////FoMlowAAAGZ0Uk5T//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8ANY6otwAAAKVJREFUeNpUzkUSwlAURNHg7u7u7u7u7g7/7X8LJFQR+D08g1tNgJArjhqBHgF9D89r6Th+EJmwEULLJg3xS5AEpK9+oW1bU4BcmXTrkSUhf9c8Uysmn6lKCIpDEuAquh3VGwZrl2NMzRRou1Z7oyfhjEflGdWAQV3ph8BBKn+dPlEgYm7F/zGArSyJQyFsIjAI1XRODMC32ONwLlVwgLmBhrcAAwAy+0+rCKRMiwAAAABJRU5ErkJggg==";
    u = new s.ScreenSpaceEventHandler(a.scene.canvas), u.setInputAction(function (e) {
        if (g) {
            if (m) {
                for (var t = 0; t < that._entityCollection.length; t++)a.entities.remove(that._entityCollection[t]);
                that._entityCollection = [], h = [], m = !1, f = new Cesium.Entity({
                    show: !0,
                    billboard: {image: v, scale: 1},
                    label: {font: "12pt 黑体", outlineWidth: 2, outlineWidth: s.LabelStyle.FILL_AND_OUTLINE}
                }), that._entityCollection.push(f), a.entities.add(f)
            }
            var i = a.camera.getPickRay(e.position);
            if (c = a.scene.globe.pick(i, a.scene), h.length > 0) {
                var r = h[0];
                r || h.pop()
            }
            if (c) {
                h.push(c);
                var o = 0;
                if (h && h.length > 1 && (o = n(h)), h.length > 0) {
                    var l = new Cesium.Entity({
                        billboard: {image: v, scale: 1},
                        label: {show: !0, font: "12pt 黑体", outlineWidth: 3, outlineWidth: s.LabelStyle.FILL_AND_OUTLINE}
                    });
                    that._entityCollection.push(l), a.entities.add(l);
                    var u = new s.CallbackProperty(function () {
                        return h
                    }, (!1));
                    d = new Cesium.Entity({
                        polyline: {
                            positions: u,
                            material: color
                        }
                    }), that._entityCollection.push(d), a.entities.add(d), l.position = c, l.show = !0, l.label.text = o.toFixed(2) + "米", p = 1
                }
            }
        }
    }, s.ScreenSpaceEventType.LEFT_CLICK), u.setInputAction(function (e) {
        g && (m = !0, 1 == p && a.entities.remove(f), p = 3)
    }, s.ScreenSpaceEventType.RIGHT_CLICK), u.setInputAction(function (e) {
        if (g && !m) {
            var t = a.camera.pickEllipsoid(e.endPosition, l);
            if (t && h && h.length > 0 && (h.length < 2 ? h[h.length] = t : h[h.length - 1] = t, 3 == p && (h[h.length] = t), p = 2, f)) {
                f.position = t;
                var i = n(h);
                f.label.show = !0, f.label.text = i.toFixed(2) + "米"
            }
        }
    }, s.ScreenSpaceEventType.MOUSE_MOVE), this.calcDistanceFromDegrees = function (e) {
        g = !1;
        var t = 0;
        if (e) {
            var i = l.cartographicArrayToCartesianArray(e);
            t = n(i)
        }
        return t
    }, this.startMeasure = function () {
        for (var e = 0; e < this._entityCollection.length; e++)a.entities.remove(this._entityCollection[e]);
        this._entityCollection = [], h = [], g = !0
    }, this.stopMeasure = function () {
        u.destroy();
        for (var e = 0; e < this._entityCollection.length; e++)a.entities.remove(this._entityCollection[e]);
        this._entityCollection = [], g = !1
    }
}
function PolygonHandler(e) {
    function t(e, t) {
        var i = t;
        if (i && i.active) {
            var r = i.viewer.scene, n = o.camera.getPickRay(e.position), a = o.scene.globe.pick(n, o.scene);
            if (a) {
                var s = r.globe.ellipsoid.cartesianToCartographic(a);
                if (longitudeString = Cesium.Math.toDegrees(s.longitude), latitudeString = Cesium.Math.toDegrees(s.latitude), s.height < 0) {
                    var l = i.viewer.camera.pickEllipsoid(e.position, r.globe.ellipsoid);
                    s = r.globe.ellipsoid.cartesianToCartographic(l), longitudeString = Cesium.Math.toDegrees(s.longitude), latitudeString = Cesium.Math.toDegrees(s.latitude), a = Cesium.Cartesian3.fromDegrees(longitudeString, latitudeString, 0)
                }
                if (i.isDrawing) {
                    var c = i.currentDrawingPolygon.positions;
                    c.push(a), i.currentDrawingPolygon.positions = c
                } else {
                    i.points.length = 0, i.isDrawing = !0;
                    var h = new Cesium.PolygonGeometry;
                    h.material.uniforms.color = Cesium.Color.BLUE.withAlpha(.5), h.positions = [a, a, a], h._height = s.height, i.currentDrawingPolygon = r.primitives.add(h), i.currentDrawingPolygon.height = s.height + 1, i.tmpPolyline = i.tmpPolylineCollection.add({
                        show: !0,
                        positions: [a, a],
                        width: 2,
                        material: Cesium.Material.fromType(Cesium.Material.ColorType, {color: new Cesium.Color(0, 0, 1, 1)})
                    })
                }
                i.points.push(d.clone(a))
            }
        }
    }

    function i(e, t) {
        var i = t;
        if (i && i.active && i.isDrawing) {
            var r = i.viewer.scene;
            if (cartesian = (r.camera, r.pickPosition(e.endPosition)), cartesian) {
                var o = r.globe.ellipsoid.cartesianToCartographic(cartesian), n = Cesium.Math.toDegrees(o.longitude), a = Cesium.Math.toDegrees(o.latitude);
                if (o.height < 0) {
                    var s = i.viewer.camera.pickEllipsoid(e.endPosition, r.globe.ellipsoid), l = r.globe.ellipsoid.cartesianToCartographic(s);
                    n = Cesium.Math.toDegrees(l.longitude), a = Cesium.Math.toDegrees(l.latitude), cartesian = Cesium.Cartesian3.fromDegrees(n, a, 0)
                }
                var c = i.currentDrawingPolygon.positions, h = c.length;
                c[h - 1] = cartesian, h >= 4 ? Cesium.defined(i.tmpPolyline) && (i.tmpPolylineCollection.removeAll(), i.tmpPolyline._destroy(), delete i.tmpPolyline, i.currentDrawingPolygon.positions = c) : i.tmpPolyline.positions = c
            }
        }
    }

    function r(e, t) {
        var i = t.drawCompletedEvent, r = t.currentDrawingPolygon;
        i.raiseEvent(r), t.deactivate()
    }

    var o = e.viewer, n = e.root;
    o.scene.globe.ellipsoid;
    if (!n.defined(o))throw new n.DeveloperError("viewer is required!");
    this.handler = new Cesium.ScreenSpaceEventHandler(o.scene.canvas), this.viewer = o, this.isDrawing = !1, this.currentDrawingPolygon = null, this.active = !1, this.tmpPolyline = null, this.tmpPolylineCollection = new n.PolylineCollection, o.scene.primitives.add(this.tmpPolylineCollection), this.drawCompletedEvent = new n.Event, this.points = [], this.activate = function () {
        this.active = !0;
        var e = this;
        this.handler.setInputAction(function (i) {
            t(i, e)
        }, Cesium.ScreenSpaceEventType.LEFT_CLICK), this.handler.setInputAction(function (t) {
            i(t, e)
        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE), this.handler.setInputAction(function (t) {
            r(t, e)
        }, Cesium.ScreenSpaceEventType.RIGHT_CLICK)
    }, this.deactivate = function () {
        this.active = !1, this.isDrawing = !1, delete this.currentPolyline, this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK), this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE), this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)
    }
}
function GASProjection() {
}
var DrawElement = function () {
    function e(e) {
        this._scene = e.scene, this._tooltip = r(e.container), this._surfaces = [], this.initialiseHandlers(), this.enhancePrimitives()
    }

    function t(e) {
        return h.cartographicArrayToCartesianArray([Cesium.Rectangle.northwest(e), Cesium.Rectangle.northeast(e), Cesium.Rectangle.southeast(e), Cesium.Rectangle.southwest(e)])
    }

    function i(e, t) {
        var i = new Cesium.Rectangle;
        i.west = Math.min(e.longitude, t.longitude), i.east = Math.max(e.longitude, t.longitude), i.south = Math.min(e.latitude, t.latitude), i.north = Math.max(e.latitude, t.latitude);
        var r = Cesium.Math.EPSILON7;
        return i.east - i.west < r && (i.east += 2 * r), i.north - i.south < r && (i.north += 2 * r), i
    }

    function r(e) {
        var t = function (e) {
            var t = document.createElement("DIV");
            t.className = "twipsy right";
            var i = document.createElement("DIV");
            i.className = "twipsy-arrow", t.appendChild(i);
            var r = document.createElement("DIV");
            r.className = "twipsy-inner", t.appendChild(r), this._div = t, this._title = r;
            var o = document.createElement("style"), n = ".twipsy {display: block; position: absolute;visibility: visible; max-width: 200px;    min-width: 100px;padding: 5px;font-size: 11px;z-index: 1000; opacity: 0.8; -khtml-opacity: 0.8;-moz-opacity: 0.8;filter: alpha(opacity=80);}", a = ".twipsy.left .twipsy-arrow {    top: 50%;right: 0;margin-top: -5px; border-top: 5px solid transparent; border-bottom: 5px solid transparent;    border-left: 5px solid #000000;}", s = ".twipsy.right .twipsy-arrow {    top: 50%;left: 0;margin-top: -5px; border-top: 5px solid transparent; border-bottom: 5px solid transparent;    border-right: 5px solid #000000;}", l = ".twipsy-inner {    padding: 3px 8px;    background-color: #000000; color: white;    text-align: center;max-width: 200px;    text-decoration: none;    -webkit-border-radius: 4px;    -moz-border-radius: 4px;    border-radius: 4px;}", c = ".twipsy-arrow {    position: absolute;    width: 0;    height: 0;}";
            o.innerHTML = n + a + s + l + c, document.head.appendChild(o), e.appendChild(t)
        };
        return t.prototype.setVisible = function (e) {
            this._div.style.display = e ? "block" : "none"
        }, t.prototype.showAt = function (e, t) {
            e && t && (this.setVisible(!0), this._title.innerHTML = t, this._div.style.left = e.x + 10 + "px", this._div.style.top = e.y - this._div.clientHeight / 2 + "px")
        }, new t(e)
    }

    function o(e, t) {
        return e.longitude.toFixed(t || 3) + ", " + e.latitude.toFixed(t || 3)
    }

    function n(e, t) {
        if (null == e || "object" != typeof e)return e;
        if (e.constructor != Object && e.constructor != Array)return e;
        if (e.constructor == Date || e.constructor == RegExp || e.constructor == Function || e.constructor == String || e.constructor == Number || e.constructor == Boolean)return new e.constructor(e);
        t = t || new e.constructor;
        for (var i in e)t[i] = "undefined" == typeof t[i] ? n(e[i], null) : t[i];
        return t
    }

    function a(e, t) {
        e = e || {};
        var i;
        for (i in t)void 0 === e[i] && (e[i] = n(t[i]))
    }

    function s(e, t) {
        var i, r = n(e);
        for (i in t)void 0 === r[i] && (r[i] = n(t[i]));
        return r
    }

    function l(e, t, i) {
        e[t] = i
    }

    function c(e) {
        e._listeners = {}, e.addListener = function (e, t) {
            return this._listeners[e] = this._listeners[e] || [], this._listeners[e].push(t), this._listeners[e].length
        }, e.executeListeners = function (e, t) {
            if (this._listeners[e.name] && this._listeners[e.name].length > 0)for (var i = 0; i < this._listeners[e.name].length; i++)this._listeners[e.name][i](e); else t && t(e)
        }
    }

    var h = Cesium.Ellipsoid.WGS84;
    e.prototype.initialiseHandlers = function () {
        function e(e, r) {
            if (1 != i._handlersMuted) {
                var o = t.pick(r);
                o && o.primitive && o.primitive[e] && o.primitive[e](r)
            }
        }

        var t = this._scene, i = this, r = new Cesium.ScreenSpaceEventHandler(t.canvas);
        r.setInputAction(function (t) {
            e("leftClick", t.position)
        }, Cesium.ScreenSpaceEventType.LEFT_CLICK), r.setInputAction(function (t) {
            e("rightClick", t.position)
        }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);
        var o;
        r.setInputAction(function (e) {
            if (1 != i._handlersMuted) {
                var r = t.pick(e.endPosition);
                !o || r && o == r.primitive || (!(o.isDestroyed && o.isDestroyed()) && o.mouseOut(e.endPosition), o = null), r && r.primitive && (r = r.primitive, r.mouseOut && (o = r), r.mouseMove && r.mouseMove(e.endPosition))
            }
        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE), r.setInputAction(function (t) {
            e("leftUp", t.position)
        }, Cesium.ScreenSpaceEventType.LEFT_UP), r.setInputAction(function (t) {
            e("leftDown", t.position)
        }, Cesium.ScreenSpaceEventType.LEFT_DOWN)
    }, e.prototype.setListener = function (e, t, i) {
        e[t] = i
    }, e.prototype.muteHandlers = function (e) {
        this._handlersMuted = e
    }, e.prototype.registerEditableShape = function (e) {
        var t = this;
        l(e, "mouseMove", function (i) {
            e.setHighlighted(!0), e._editMode || t._tooltip.showAt(i, "点击编辑此图形")
        }), l(e, "mouseOut", function (i) {
            e.setHighlighted(!1), t._tooltip.setVisible(!1)
        }), l(e, "leftClick", function (t) {
            e.setEditMode(!0)
        })
    }, e.prototype.startDrawing = function (e) {
        this.disableAllEditMode(), this.editCleanUp && this.editCleanUp(), this.editCleanUp = e, this.muteHandlers(!0)
    }, e.prototype.stopDrawing = function () {
        this.editCleanUp && (this.editCleanUp(), this.editCleanUp = null), this.muteHandlers(!1)
    }, e.prototype.disableAllHighlights = function () {
        this.setHighlighted(void 0)
    }, e.prototype.setHighlighted = function (e) {
        this._highlightedSurface && !this._highlightedSurface.isDestroyed() && this._highlightedSurface != e && this._highlightedSurface.setHighlighted(!1), this._highlightedSurface = e
    }, e.prototype.disableAllEditMode = function () {
        this.setEdited(void 0)
    }, e.prototype.setEdited = function (e) {
        this._editedSurface && !this._editedSurface.isDestroyed() && this._editedSurface.setEditMode(!1), this._editedSurface = e
    };
    var u = Cesium.Material.fromType(Cesium.Material.ColorType);
    u.uniforms.color = new Cesium.Color(1, 0, 0, .5);
    var d = {
        ellipsoid: Cesium.Ellipsoid.WGS84,
        textureRotationAngle: 0,
        asynchronous: !0,
        show: !0,
        debugShowBoundingVolume: !1
    }, p = s(d, {
        appearance: new Cesium.EllipsoidSurfaceAppearance({aboveGround: !0}),
        material: u,
        granularity: Math.PI / 180
    }), m = s(d, {material: Cesium.Color.BLUE.withAlpha(.5)}), g = s(d, {material: Cesium.Color.BLUE.withAlpha(.5)}), f = s(d, {material: Cesium.Color.BLUE.withAlpha(.5)}), v = s(p, {rotation: 0}), y = s(d, {
        width: 5,
        geodesic: !0,
        granularity: 1e4,
        appearance: new Cesium.PolylineMaterialAppearance({aboveGround: !0}),
        material: u
    }), C = function () {
        function e() {
        }

        return e.prototype.initialiseOptions = function (e) {
            a(this, e), this._ellipsoid = void 0, this._granularity = void 0, this._height = void 0, this._textureRotationAngle = void 0, this._id = void 0, this._createPrimitive = !0, this._primitive = void 0, this._outlinePolygon = void 0
        }, e.prototype.setAttribute = function (e, t) {
            this[e] = t, this._createPrimitive = !0
        }, e.prototype.getAttribute = function (e) {
            return this[e]
        }, e.prototype.update = function (e, t, i) {
            if (!Cesium.defined(this.ellipsoid))throw new Cesium.DeveloperError("this.ellipsoid 需要被定义.");
            if (!Cesium.defined(this.appearance))throw new Cesium.DeveloperError("this.material 需要被定义.");
            if (this.granularity < 0)throw new Cesium.DeveloperError("this.granularity and scene2D/scene3D overrides must be greater than zero.");
            if (this.show && (this._createPrimitive || Cesium.defined(this._primitive))) {
                if (this._createPrimitive || this._ellipsoid !== this.ellipsoid || this._granularity !== this.granularity || this._height !== this.height || this._textureRotationAngle !== this.textureRotationAngle || this._id !== this.id) {
                    var r = this.getGeometry();
                    if (!r)return;
                    if (this._createPrimitive = !1, this._ellipsoid = this.ellipsoid, this._granularity = this.granularity, this._height = this.height, this._textureRotationAngle = this.textureRotationAngle, this._id = this.id, this._primitive = this._primitive && this._primitive.destroy(), this._primitive = new Cesium.Primitive({
                            geometryInstances: new Cesium.GeometryInstance({
                                geometry: r, id: this.id, pickPrimitive: this
                            }), appearance: this.appearance, asynchronous: this.asynchronous
                        }), this._outlinePolygon = this._outlinePolygon && this._outlinePolygon.destroy(), this.strokeColor && this.getOutlineGeometry) {
                        var o = 1;
                        void 0 != e._aliasedLineWidthRange && (o = e._aliasedLineWidthRange[0]), this._outlinePolygon = new Cesium.Primitive({
                            geometryInstances: new Cesium.GeometryInstance({
                                geometry: this.getOutlineGeometry(),
                                attributes: {color: Cesium.ColorGeometryInstanceAttribute.fromColor(this.strokeColor)}
                            }),
                            appearance: new Cesium.PerInstanceColorAppearance({
                                flat: !0,
                                renderState: {depthTest: {enabled: !0}, lineWidth: Math.min(this.strokeWidth || 4, o)}
                            })
                        })
                    }
                }
                var n = this._primitive;
                n.appearance.material = this.material, n.debugShowBoundingVolume = this.debugShowBoundingVolume, n.update(e, t, i), this._outlinePolygon && this._outlinePolygon.update(e, t, i)
            }
        }, e.prototype.isDestroyed = function () {
            return !1
        }, e.prototype.destroy = function () {
            return this._primitive = this._primitive && this._primitive.destroy(), Cesium.destroyObject(this)
        }, e.prototype.setStrokeStyle = function (e, t) {
            this.strokeColor && this.strokeColor.equals(e) && this.strokeWidth == t || (this._createPrimitive = !0, this.strokeColor = e, this.strokeWidth = t)
        }, e
    }();
    e.ExtentPrimitive = function () {
        function e(e) {
            if (!Cesium.defined(e.extent))throw new Cesium.DeveloperError("Extent is required");
            e = s(e, p), this.initialiseOptions(e), this.setExtent(e.extent)
        }

        return e.prototype = new C, e.prototype.setExtent = function (e) {
            this.setAttribute("extent", e)
        }, e.prototype.getExtent = function () {
            return this.getAttribute("extent")
        }, e.prototype.getGeometry = function () {
            if (Cesium.defined(this.extent))return new Cesium.RectangleGeometry({
                rectangle: this.extent,
                height: this.height,
                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,
                stRotation: this.textureRotationAngle,
                ellipsoid: this.ellipsoid,
                granularity: this.granularity
            })
        }, e.prototype.getOutlineGeometry = function () {
            return new Cesium.RectangleOutlineGeometry({rectangle: this.extent})
        }, e
    }(), e.PolygonPrimitive = function () {
        function e(e) {
            e = s(e, p), this.initialiseOptions(e), this.isPolygon = !0
        }

        return e.prototype = new C, e.prototype.setPositions = function (e) {
            this.setAttribute("positions", e)
        }, e.prototype.getPositions = function () {
            return this.getAttribute("positions")
        }, e.prototype.getGeometry = function () {
            if (Cesium.defined(this.positions) && !(this.positions.length < 3))return Cesium.PolygonGeometry.fromPositions({
                positions: this.positions,
                height: this.height,
                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,
                stRotation: this.textureRotationAngle,
                ellipsoid: this.ellipsoid,
                granularity: this.granularity
            })
        }, e.prototype.getOutlineGeometry = function () {
            return Cesium.PolygonOutlineGeometry.fromPositions({positions: this.getPositions()})
        }, e
    }(), e.CirclePrimitive = function () {
        function e(e) {
            if (!Cesium.defined(e.center) || !Cesium.defined(e.radius))throw new Cesium.DeveloperError("Center and radius are required");
            e = s(e, p), this.initialiseOptions(e), this.setRadius(e.radius)
        }

        return e.prototype = new C, e.prototype.setCenter = function (e) {
            this.setAttribute("center", e)
        }, e.prototype.setRadius = function (e) {
            this.setAttribute("radius", Math.max(.1, e))
        }, e.prototype.getCenter = function () {
            return this.getAttribute("center")
        }, e.prototype.getRadius = function () {
            return this.getAttribute("radius")
        }, e.prototype.getGeometry = function () {
            if (Cesium.defined(this.center) && Cesium.defined(this.radius))return new Cesium.CircleGeometry({
                center: this.center,
                radius: this.radius,
                height: this.height,
                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,
                stRotation: this.textureRotationAngle,
                ellipsoid: this.ellipsoid,
                granularity: this.granularity
            })
        }, e.prototype.getOutlineGeometry = function () {
            return new Cesium.CircleOutlineGeometry({center: this.getCenter(), radius: this.getRadius()})
        }, e
    }(), e.EllipsePrimitive = function () {
        function e(e) {
            if (!(Cesium.defined(e.center) && Cesium.defined(e.semiMajorAxis) && Cesium.defined(e.semiMinorAxis)))throw new Cesium.DeveloperError("Center and semi major and semi minor axis are required");
            e = s(e, v), this.initialiseOptions(e)
        }

        return e.prototype = new C, e.prototype.setCenter = function (e) {
            this.setAttribute("center", e)
        }, e.prototype.setSemiMajorAxis = function (e) {
            e < this.getSemiMinorAxis() || this.setAttribute("semiMajorAxis", e)
        }, e.prototype.setSemiMinorAxis = function (e) {
            e > this.getSemiMajorAxis() || this.setAttribute("semiMinorAxis", e)
        }, e.prototype.setRotation = function (e) {
            return this.setAttribute("rotation", e)
        }, e.prototype.getCenter = function () {
            return this.getAttribute("center")
        }, e.prototype.getSemiMajorAxis = function () {
            return this.getAttribute("semiMajorAxis")
        }, e.prototype.getSemiMinorAxis = function () {
            return this.getAttribute("semiMinorAxis")
        }, e.prototype.getRotation = function () {
            return this.getAttribute("rotation")
        }, e.prototype.getGeometry = function () {
            if (Cesium.defined(this.center) && Cesium.defined(this.semiMajorAxis) && Cesium.defined(this.semiMinorAxis))return new Cesium.EllipseGeometry({
                ellipsoid: this.ellipsoid,
                center: this.center,
                semiMajorAxis: this.semiMajorAxis,
                semiMinorAxis: this.semiMinorAxis,
                rotation: this.rotation,
                height: this.height,
                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,
                stRotation: this.textureRotationAngle,
                ellipsoid: this.ellipsoid,
                granularity: this.granularity
            })
        }, e.prototype.getOutlineGeometry = function () {
            return new Cesium.EllipseOutlineGeometry({
                center: this.getCenter(),
                semiMajorAxis: this.getSemiMajorAxis(),
                semiMinorAxis: this.getSemiMinorAxis(),
                rotation: this.getRotation()
            })
        }, e
    }(), e.PolylinePrimitive = function () {
        function e(e) {
            e = s(e, y), this.initialiseOptions(e)
        }

        return e.prototype = new C, e.prototype.setPositions = function (e) {
            this.setAttribute("positions", e)
        }, e.prototype.setWidth = function (e) {
            this.setAttribute("width", e)
        }, e.prototype.setGeodesic = function (e) {
            this.setAttribute("geodesic", e)
        }, e.prototype.getPositions = function () {
            return this.getAttribute("positions")
        }, e.prototype.getWidth = function () {
            return this.getAttribute("width")
        }, e.prototype.getGeodesic = function (e) {
            return this.getAttribute("geodesic")
        }, e.prototype.getGeometry = function () {
            if (Cesium.defined(this.positions) && !(this.positions.length < 2))return new Cesium.PolylineGeometry({
                positions: this.positions,
                height: this.height,
                width: this.width < 1 ? 1 : this.width,
                vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,
                ellipsoid: this.ellipsoid
            })
        }, e
    }();
    var w = {
        iconUrl: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKHAksBNXfIvIAAADGSURBVBjTlZC9DsFgFIafWsQgDE0vwGBjNVjNdYl1BYYmbkDim0yMEotFooNEW+Wjr6GfpCQG73J+nmc5B/6I924kNYEh0APawAXYAxvP827URUlTSZGkg6S7q5HbN+vySNJM0lOfebr9CKABUBRFH5i851oawMTxCuZ53gGCH3cFjldymqYZcPohnxyv5CzLdsASKL/EElg6XsnW2rUxZgHMgSPwcHVujFlYa9cff47juJUkyRgYAF3gDGx931+FYXjl37wANeOE+Ghv1/sAAAAASUVORK5CYII=",
        shiftX: 0,
        shiftY: 0
    }, _ = {
        iconUrl: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKHAksBNXfIvIAAADGSURBVBjTlZC9DsFgFIafWsQgDE0vwGBjNVjNdYl1BYYmbkDim0yMEotFooNEW+Wjr6GfpCQG73J+nmc5B/6I924kNYEh0APawAXYAxvP827URUlTSZGkg6S7q5HbN+vySNJM0lOfebr9CKABUBRFH5i851oawMTxCuZ53gGCH3cFjldymqYZcPohnxyv5CzLdsASKL/EElg6XsnW2rUxZgHMgSPwcHVujFlYa9cff47juJUkyRgYAF3gDGx931+FYXjl37wANeOE+Ghv1/sAAAAASUVORK5CYII=",
        shiftX: 0,
        shiftY: 0
    }, A = {
        iconUrl: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAYAAACprHcmAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sKHAksIgfSpw8AAAFQSURBVBjTlZC/axphAIaf+87e5dTUkCGSDoIVuzUgZBM3hyCCAef0PxQiBRMhBgx26ODSUgIedJAG1BAI5Ls7vu+7H12iuw+88A7P8r6wB9a29Pt917KsM+AzcAi8AX+zLPs1GAzUTu71eq4Q4qLb7V42m812Pp8vB0Gwns1md6PR6DpN09vhcKhsgHq9ft7pdK5arda3KIpKYRjacRx/rFarZ4D2ff/fYrF4ygEYY740Go32er0WWZahtcYYQ5qmolartY0xE+BnDkBrXbIs60RKiZQhSRLvRjmOc6K1LgHkAJRSwWbz8hxFySfbdrFtdyeHYfCslAoAxLvsT6fTB887TF23wDaOU0jn8/mDUsoHsAHK5fLm8fHPhyTJstPTyrHnFQ+klJv7+/F4Mrn5LoS4W61W8e7nSqXiSSmbwFfgCHgFfheLxR/L5TJiX/4DB6mbvqBlRUAAAAAASUVORK5CYII=",
        shiftX: 0,
        shiftY: 0
    };
    return e.prototype.createBillboardGroup = function (t, i, r) {
        var o = new e.BillboardGroup(this, i);
        return o.addBillboards(t, r), o
    }, e.BillboardGroup = function (e, t) {
        this._drawHelper = e, this._scene = e._scene, this._options = s(t, w);
        var i = new Cesium.BillboardCollection;
        this._scene.primitives.add(i), this._billboards = i, this._orderedBillboards = []
    }, e.BillboardGroup.prototype.createBillboard = function (e, t) {
        function i(e) {
            a.enableRotate = e
        }

        function r() {
            for (var e = 0, t = n._orderedBillboards.length; e < t && n._orderedBillboards[e] != o; ++e);
            return e
        }

        var o = this._billboards.add({
            show: !0,
            position: e,
            pixelOffset: new Cesium.Cartesian2(this._options.shiftX, this._options.shiftY),
            eyeOffset: new Cesium.Cartesian3(0, 0, 0),
            horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
            verticalOrigin: Cesium.VerticalOrigin.CENTER,
            scale: 1,
            image: this._options.iconUrl,
            color: new Cesium.Color(1, 1, 1, 1)
        });
        if (t) {
            var n = this, a = this._scene.screenSpaceCameraController;
            if (t.dragHandlers) {
                var n = this;
                l(o, "leftDown", function (e) {
                    function a(e) {
                        o.position = e;
                        for (var i = 0, a = n._orderedBillboards.length; i < a && n._orderedBillboards[i] != o; ++i);
                        t.dragHandlers.onDrag && t.dragHandlers.onDrag(r(), e)
                    }

                    function s(e) {
                        l.destroy(), i(!0), t.dragHandlers.onDragEnd && t.dragHandlers.onDragEnd(r(), e)
                    }

                    var l = new Cesium.ScreenSpaceEventHandler(n._scene.canvas);
                    l.setInputAction(function (e) {
                        var t = n._scene.camera.pickEllipsoid(e.endPosition, h);
                        t ? a(t) : s(t)
                    }, Cesium.ScreenSpaceEventType.MOUSE_MOVE), l.setInputAction(function (e) {
                        s(n._scene.camera.pickEllipsoid(e.position, h))
                    }, Cesium.ScreenSpaceEventType.LEFT_UP), i(!1), t.dragHandlers.onDragStart && t.dragHandlers.onDragStart(r(), n._scene.camera.pickEllipsoid(e, h))
                })
            }
            t.onClick && l(o, "rightClick", function (e) {
                t.onClick(r())
            }), t.onClick && l(o, "leftClick", function (e) {
                t.onClick(r())
            }), t.tooltip && (l(o, "mouseMove", function (e) {
                n._drawHelper._tooltip.showAt(e, t.tooltip())
            }), l(o, "mouseOut", function (e) {
                n._drawHelper._tooltip.setVisible(!1)
            }))
        }
        return o
    }, e.BillboardGroup.prototype.insertBillboard = function (e, t, i) {
        this._orderedBillboards.splice(e, 0, this.createBillboard(t, i))
    }, e.BillboardGroup.prototype.addBillboard = function (e, t) {
        this._orderedBillboards.push(this.createBillboard(e, t))
    }, e.BillboardGroup.prototype.addBillboards = function (e, t) {
        for (var i = 0; i < e.length; i++)this.addBillboard(e[i], t)
    }, e.BillboardGroup.prototype.updateBillboardsPositions = function (e) {
        for (var t = 0; t < e.length; t++)this.getBillboard(t).position = e[t]
    }, e.BillboardGroup.prototype.countBillboards = function () {
        return this._orderedBillboards.length
    }, e.BillboardGroup.prototype.getBillboard = function (e) {
        return this._orderedBillboards[e]
    }, e.BillboardGroup.prototype.removeBillboard = function (e) {
        this._billboards.remove(this.getBillboard(e)), this._orderedBillboards.splice(e, 1)
    }, e.BillboardGroup.prototype.remove = function () {
        this._billboards = this._billboards && this._billboards.removeAll() && this._billboards.destroy()
    }, e.BillboardGroup.prototype.setOnTop = function () {
        this._scene.primitives.raiseToTop(this._billboards)
    }, e.prototype.startDrawingMarker = function (t) {
        var t = s(t, w);
        this.startDrawing(function () {
            a.remove(), l.destroy(), n.setVisible(!1)
        });
        var i = this, r = this._scene, n = (r.primitives, this._tooltip), a = new e.BillboardGroup(this, t), l = new Cesium.ScreenSpaceEventHandler(r.canvas);
        l.setInputAction(function (e) {
            if (null != e.position) {
                var o = r.camera.pickEllipsoid(e.position, h);
                o && (a.addBillboard(o), i.stopDrawing(), t.callback(o))
            }
        }, Cesium.ScreenSpaceEventType.LEFT_CLICK), l.setInputAction(function (e) {
            var t = e.endPosition;
            if (null != t) {
                var i = r.camera.pickEllipsoid(t, h);
                i ? n.showAt(t, "<p>点击添加标记. 位置: </p>" + o(h.cartesianToCartographic(i))) : n.showAt(t, "<p>点击添加标记.</p>")
            }
        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE)
    }, e.prototype.startDrawingPolygon = function (e) {
        var e = s(e, p);
        this.startDrawingPolyshape(!0, e)
    }, e.prototype.startDrawingPolyline = function (e) {
        var e = s(e, y);
        this.startDrawingPolyshape(!1, e)
    }, e.prototype.startDrawingPolyshape = function (t, i) {
        this.startDrawing(function () {
            a.remove(r), u.remove(), d.destroy(), s.setVisible(!1)
        });
        var r, o = this, n = this._scene, a = n.primitives, s = this._tooltip, l = t ? 3 : 2;
        r = t ? new DrawElement.PolygonPrimitive(i) : new DrawElement.PolylinePrimitive(i), r.asynchronous = !1, a.add(r);
        var c = [], u = new e.BillboardGroup(this, w), d = new Cesium.ScreenSpaceEventHandler(n.canvas);
        d.setInputAction(function (e) {
            if (null != e.position) {
                var t = n.camera.pickEllipsoid(e.position, h);
                t && (0 == c.length && (c.push(t.clone()), u.addBillboard(c[0])), c.length >= l && (r.positions = c, r._createPrimitive = !0), c.push(t), u.addBillboard(t))
            }
        }, Cesium.ScreenSpaceEventType.LEFT_CLICK), d.setInputAction(function (e) {
            var t = e.endPosition;
            if (null != t)if (0 == c.length)s.showAt(t, "<p>点击添加第一个点</p>"); else {
                var i = n.camera.pickEllipsoid(t, h);
                i && (c.pop(), i.y += 1 + Math.random(), c.push(i), c.length >= l && (r.positions = c, r._createPrimitive = !0), u.getBillboard(c.length - 1).position = i, s.showAt(t, "<p>点击添加新的点 (" + c.length + ")</p>" + (c.length > l ? "<p>点击右键完成绘制</p>" : "")))
            }
        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE), d.setInputAction(function (e) {
            var t = e.position;
            if (null != t) {
                if (c.length < l)return;
                var r = n.camera.pickEllipsoid(t, h);
                if (r && (o.stopDrawing(), "function" == typeof i.callback)) {
                    for (var a = c.length - 1, s = Cesium.Math.EPSILON3; a > 0 && c[a].equalsEpsilon(c[a - 1], s); a--);
                    i.callback(c.splice(0, a + 1))
                }
            }
        }, Cesium.ScreenSpaceEventType.RIGHT_CLICK)
    }, e.prototype.startDrawingExtent = function (r) {
        function o(i) {
            null == d && (d = new DrawElement.ExtentPrimitive({
                extent: i,
                material: r.material
            }), d.asynchronous = !1, l.add(d)), d.setExtent(i);
            var o = t(i);
            null == m ? (m = new e.BillboardGroup(n, w), m.addBillboards(o)) : m.updateBillboardsPositions(o)
        }

        var r = s(r, p);
        this.startDrawing(function () {
            null != d && l.remove(d), m.remove(), g.destroy(), c.setVisible(!1)
        });
        var n = this, a = this._scene, l = this._scene.primitives, c = this._tooltip, u = null, d = null, m = null, g = new Cesium.ScreenSpaceEventHandler(a.canvas);
        g.setInputAction(function (e) {
            if (null != e.position) {
                var t = a.camera.pickEllipsoid(e.position, h);
                if (t)if (null == d) {
                    u = h.cartesianToCartographic(t);
                    var s = i(u, u);
                    o(s)
                } else n.stopDrawing(), "function" == typeof r.callback && r.callback(i(u, h.cartesianToCartographic(t)))
            }
        }, Cesium.ScreenSpaceEventType.LEFT_DOWN), g.setInputAction(function (e) {
            var t = e.endPosition;
            if (null != t)if (null == d)c.showAt(t, "<p>点击开始绘制矩形</p>"); else {
                var r = a.camera.pickEllipsoid(t, h);
                if (r) {
                    var n = i(u, h.cartesianToCartographic(r));
                    o(n), c.showAt(t, "<p>拖动改变矩形范围</p><p>再次点击完成绘制</p>")
                }
            }
        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE)
    }, e.prototype.startDrawingCircle = function (t) {
        var t = s(t, p);
        this.startDrawing(function () {
            null != a && o.remove(a), l.remove(), c.destroy(), n.setVisible(!1)
        });
        var i = this, r = this._scene, o = this._scene.primitives, n = this._tooltip, a = null, l = null, c = new Cesium.ScreenSpaceEventHandler(r.canvas);
        c.setInputAction(function (n) {
            if (null != n.position) {
                var s = r.camera.pickEllipsoid(n.position, h);
                s && (null == a ? (a = new e.CirclePrimitive({
                    center: s,
                    radius: 0,
                    asynchronous: !1,
                    material: t.material
                }), o.add(a), l = new e.BillboardGroup(i, w), l.addBillboards([s])) : ("function" == typeof t.callback && t.callback(a.getCenter(), a.getRadius()), i.stopDrawing()))
            }
        }, Cesium.ScreenSpaceEventType.LEFT_DOWN), c.setInputAction(function (e) {
            var t = e.endPosition;
            if (null != t)if (null == a)n.showAt(t, "<p>点击开始绘制圆</p>"); else {
                var i = r.camera.pickEllipsoid(t, h);
                i && (a.setRadius(Cesium.Cartesian3.distance(a.getCenter(), i)), l.updateBillboardsPositions(i), n.showAt(t, "<p>移动鼠标改变圆半径</p><p>再次点击完成绘制</p>"))
            }
        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE)
    }, e.prototype.enhancePrimitives = function () {
        function r(e) {
            n._scene;
            this._highlighted && this._highlighted == e || this._editMode !== !0 && (this._highlighted = e, e ? (n.setHighlighted(this), this._strokeColor = this.strokeColor, this.setStrokeStyle(Cesium.Color.fromCssColorString("white"), this.strokeWidth)) : this._strokeColor ? this.setStrokeStyle(this._strokeColor, this.strokeWidth) : this.setStrokeStyle(void 0, void 0))
        }

        function o(t) {
            function i(e, t) {
                var i = e - 1 < 0 ? t.length - 1 : e - 1;
                i < c.countBillboards() && (c.getBillboard(i).position = o(i)), i = e, i < c.countBillboards() && (c.getBillboard(i).position = o(i))
            }

            function r() {
                s.executeListeners({name: "onEdited", positions: s.positions})
            }

            function o(e) {
                var t = s.positions;
                return h.cartographicToCartesian(new Cesium.EllipsoidGeodesic(h.cartesianToCartographic(t[e]), h.cartesianToCartographic(t[e < t.length - 1 ? e + 1 : 0])).interpolateUsingFraction(.5))
            }

            if (this._editMode != t)if (n.disableAllHighlights(), t) {
                n.setEdited(this);
                var a = n._scene, s = this;
                if (null == this._markers) {
                    var l = new e.BillboardGroup(n, _), c = new e.BillboardGroup(n, A), u = {
                        dragHandlers: {
                            onDrag: function (e, t) {
                                s.positions[e] = t, i(e, s.positions), s._createPrimitive = !0
                            }, onDragEnd: function (e, t) {
                                s._createPrimitive = !0, r()
                            }
                        }, onDoubleClick: function (e) {
                            s.positions.length < 4 || (s.positions.splice(e, 1), s._createPrimitive = !0, l.removeBillboard(e), c.removeBillboard(e), i(e, s.positions), r())
                        }, tooltip: function () {
                            if (s.positions.length > 3)return "点击移动点"
                        }
                    };
                    l.addBillboards(s.positions, u), this._markers = l;
                    for (var d = [], p = 0, m = s.positions.length + (this.isPolygon ? 0 : -1); p < m; p++)d.push(o(p));
                    var g = {
                        dragHandlers: {
                            onDragStart: function (e, t) {
                                this.index = e + 1, s.positions.splice(this.index, 0, t), s._createPrimitive = !0
                            }, onDrag: function (e, t) {
                                s.positions[this.index] = t, s._createPrimitive = !0
                            }, onDragEnd: function (e, t) {
                                l.insertBillboard(this.index, t, u), c.getBillboard(this.index - 1).position = o(this.index - 1), c.insertBillboard(this.index, o(this.index), g), s._createPrimitive = !0, r()
                            }
                        }, tooltip: function () {
                            return "拖动增加一个新的点"
                        }
                    };
                    c.addBillboards(d, g), this._editMarkers = c, this._globeClickhandler = new Cesium.ScreenSpaceEventHandler(a.canvas), this._globeClickhandler.setInputAction(function (e) {
                        var t = a.pick(e.position);
                        t && t.primitive || s.setEditMode(!1)
                    }, Cesium.ScreenSpaceEventType.LEFT_CLICK), l.setOnTop(), c.setOnTop()
                }
                this._editMode = !0
            } else null != this._markers && (this._markers.remove(), this._editMarkers.remove(), this._markers = null, this._editMarkers = null, this._globeClickhandler.destroy()), this._editMode = !1
        }

        var n = this;
        Cesium.Billboard.prototype.setEditable = function () {
            function e(e) {
                DrawElement._scene.screenSpaceCameraController.enableRotate = e
            }

            if (!this._editable) {
                this._editable = !0;
                var t = this, i = this;
                l(t, "leftDown", function (r) {
                    function o(e) {
                        t.position = e, i.executeListeners({name: "drag", positions: e})
                    }

                    function a(t) {
                        s.destroy(), e(!0), i.executeListeners({name: "dragEnd", positions: t})
                    }

                    var s = new Cesium.ScreenSpaceEventHandler(n._scene.canvas);
                    s.setInputAction(function (e) {
                        var t = n._scene.camera.pickEllipsoid(e.endPosition, h);
                        t ? o(t) : a(t)
                    }, Cesium.ScreenSpaceEventType.MOUSE_MOVE), s.setInputAction(function (e) {
                        a(n._scene.camera.pickEllipsoid(e.position, h))
                    }, Cesium.ScreenSpaceEventType.LEFT_UP), e(!1)
                }), c(t)
            }
        }, DrawElement.PolylinePrimitive.prototype.setEditable = function () {
            if (!this.setEditMode) {
                var e = this;
                e.isPolygon = !1, e.asynchronous = !1, n.registerEditableShape(e), e.setEditMode = o;
                var t = this.width;
                e.setHighlighted = function (e) {
                    this._editMode !== !0 && (e ? (n.setHighlighted(this), this.setWidth(2 * t)) : this.setWidth(t))
                }, e.getExtent = function () {
                    return Cesium.Extent.fromCartographicArray(h.cartesianArrayToCartographicArray(this.positions))
                }, c(e), e.setEditMode(!1)
            }
        }, DrawElement.PolygonPrimitive.prototype.setEditable = function () {
            var e = this;
            e.asynchronous = !1;
            n._scene;
            n.registerEditableShape(e), e.setEditMode = o, e.setHighlighted = r, c(e), e.setEditMode(!1)
        }, DrawElement.ExtentPrimitive.prototype.setEditable = function () {
            if (!this.setEditMode) {
                var o = this, a = n._scene;
                n.registerEditableShape(o), o.asynchronous = !1, o.setEditMode = function (r) {
                    function s() {
                        o.executeListeners({name: "onEdited", extent: o.extent})
                    }

                    if (this._editMode != r)if (n.disableAllHighlights(), r) {
                        if (n.setEdited(this), null == this._markers) {
                            var l = new e.BillboardGroup(n, _), c = {
                                dragHandlers: {
                                    onDrag: function (e, r) {
                                        var n = l.getBillboard((e + 2) % 4).position;
                                        o.setExtent(i(h.cartesianToCartographic(n), h.cartesianToCartographic(r))), l.updateBillboardsPositions(t(o.extent))
                                    }, onDragEnd: function (e, t) {
                                        s()
                                    }
                                }, tooltip: function () {
                                    return "拖动改变范围"
                                }
                            };
                            l.addBillboards(t(o.extent), c), this._markers = l, this._globeClickhandler = new Cesium.ScreenSpaceEventHandler(a.canvas), this._globeClickhandler.setInputAction(function (e) {
                                var t = a.pick(e.position);
                                t && !t.isDestroyed() && t.primitive || o.setEditMode(!1)
                            }, Cesium.ScreenSpaceEventType.LEFT_CLICK), l.setOnTop()
                        }
                        this._editMode = !0
                    } else null != this._markers && (this._markers.remove(), this._markers = null, this._globeClickhandler.destroy()), this._editMode = !1
                }, o.setHighlighted = r, c(o), o.setEditMode(!1)
            }
        }, e.EllipsePrimitive.prototype.setEditable = function () {
            if (!this.setEditMode) {
                var t = this, i = n._scene;
                t.asynchronous = !1, n.registerEditableShape(t), t.setEditMode = function (r) {
                    function o() {
                        return Cesium.Shapes.computeEllipseBoundary(h, t.getCenter(), t.getSemiMajorAxis(), t.getSemiMinorAxis(), t.getRotation() + Math.PI / 2, Math.PI / 2).splice(0, 4)
                    }

                    function a() {
                        t.executeListeners({
                            name: "onEdited",
                            center: t.getCenter(),
                            semiMajorAxis: t.getSemiMajorAxis(),
                            semiMinorAxis: t.getSemiMinorAxis(),
                            rotation: 0
                        })
                    }

                    if (this._editMode != r)if (n.disableAllHighlights(), r) {
                        n.setEdited(this);
                        var s = this;
                        if (null == this._markers) {
                            var l = new e.BillboardGroup(n, _), c = {
                                dragHandlers: {
                                    onDrag: function (e, i) {
                                        var r = Cesium.Cartesian3.distance(t.getCenter(), i);
                                        e % 2 == 0 ? t.setSemiMajorAxis(r) : t.setSemiMinorAxis(r), l.updateBillboardsPositions(o())
                                    }, onDragEnd: function (e, t) {
                                        a()
                                    }
                                }, tooltip: function () {
                                    return "拖动改变圆偏心距和半径"
                                }
                            };
                            l.addBillboards(o(), c), this._markers = l, this._globeClickhandler = new Cesium.ScreenSpaceEventHandler(i.canvas), this._globeClickhandler.setInputAction(function (e) {
                                var t = i.pick(e.position);
                                t && t.primitive || s.setEditMode(!1)
                            }, Cesium.ScreenSpaceEventType.LEFT_CLICK), l.setOnTop()
                        }
                        this._editMode = !0
                    } else null != this._markers && (this._markers.remove(), this._markers = null, this._globeClickhandler.destroy()), this._editMode = !1
                }, t.setHighlighted = r, c(t), t.setEditMode(!1)
            }
        }, e.CirclePrimitive.prototype.getCircleCartesianCoordinates = function (e) {
            for (var t, i = Cesium.CircleOutlineGeometry.createGeometry(new Cesium.CircleOutlineGeometry({
                ellipsoid: h,
                center: this.getCenter(),
                radius: this.getRadius(),
                granularity: e
            })), r = 0, o = []; r < i.attributes.position.values.length; r += 3)t = i.attributes.position.values, o.push(new Cesium.Cartesian3(t[r], t[r + 1], t[r + 2]));
            return o
        }, e.CirclePrimitive.prototype.setEditable = function () {
            if (!this.setEditMode) {
                var t = this, i = n._scene;
                t.asynchronous = !1, n.registerEditableShape(t), t.setEditMode = function (r) {
                    function o() {
                        return s.getCircleCartesianCoordinates(Cesium.Math.PI_OVER_TWO)
                    }

                    function a() {
                        t.executeListeners({name: "onEdited", center: t.getCenter(), radius: t.getRadius()})
                    }

                    if (this._editMode != r)if (n.disableAllHighlights(), r) {
                        n.setEdited(this);
                        var s = this;
                        if (null == this._markers) {
                            var l = new e.BillboardGroup(n, _), c = {
                                dragHandlers: {
                                    onDrag: function (e, i) {
                                        t.setRadius(Cesium.Cartesian3.distance(t.getCenter(), i)), l.updateBillboardsPositions(o())
                                    }, onDragEnd: function (e, t) {
                                        a()
                                    }
                                }, tooltip: function () {
                                    return "拖动改变半径"
                                }
                            };
                            l.addBillboards(o(), c), this._markers = l, this._globeClickhandler = new Cesium.ScreenSpaceEventHandler(i.canvas), this._globeClickhandler.setInputAction(function (e) {
                                var t = i.pick(e.position);
                                t && t.primitive || s.setEditMode(!1)
                            }, Cesium.ScreenSpaceEventType.LEFT_CLICK), l.setOnTop()
                        }
                        this._editMode = !0
                    } else null != this._markers && (this._markers.remove(), this._markers = null, this._globeClickhandler.destroy()), this._editMode = !1
                }, t.setHighlighted = r, c(t), t.setEditMode(!1)
            }
        }
    }, e.DrawHelperWidget = function () {
        function e(e, t) {
            function i(e, t, i, r) {
                var o = document.createElement("DIV");
                o.className = "button", o.title = i, n.appendChild(o), o.onclick = r;
                var a = document.createElement("SPAN");
                o.appendChild(a);
                var s = document.createElement("IMG");
                return s.src = t, a.appendChild(s), o
            }

            if (!Cesium.defined(t.container))throw new Cesium.DeveloperError("Container is required");
            var r = {
                markerIcon: "./img/glyphicons_242_google_maps.png",
                polylineIcon: "./img/glyphicons_097_vector_path_line.png",
                polygonIcon: "./img/glyphicons_096_vector_path_polygon.png",
                circleIcon: "./img/glyphicons_095_vector_path_circle.png",
                extentIcon: "./img/glyphicons_094_vector_path_square.png",
                clearIcon: "./img/glyphicons_067_cleaning.png",
                polylineDrawingOptions: y,
                polygonDrawingOptions: m,
                extentDrawingOptions: g,
                circleDrawingOptions: f
            };
            a(t, r);
            var o = this, n = document.createElement("DIV");
            n.className = "toolbar", t.container.appendChild(n);
            var s = e._scene;
            i("marker", t.markerIcon, "点击开始绘制2D标记", function () {
                e.startDrawingMarker({
                    callback: function (e) {
                        o.executeListeners({name: "markerCreated", position: e})
                    }
                })
            }), i("polyline", t.polylineIcon, "点击开始绘制 2D线", function () {
                e.startDrawingPolyline({
                    callback: function (e) {
                        o.executeListeners({name: "polylineCreated", positions: e})
                    }
                })
            }), i("polygon", t.polygonIcon, "点击开始绘制 2D 区", function () {
                e.startDrawingPolygon({
                    callback: function (e) {
                        o.executeListeners({name: "polygonCreated", positions: e})
                    }
                })
            }), i("extent", t.extentIcon, "点击绘制一个范围", function () {
                e.startDrawingExtent({
                    callback: function (e) {
                        o.executeListeners({name: "extentCreated", extent: e})
                    }
                })
            }), i("circle", t.circleIcon, "点击开始绘制圆", function () {
                e.startDrawingCircle({
                    callback: function (e, t) {
                        o.executeListeners({name: "circleCreated", center: e, radius: t})
                    }
                })
            });
            var l = document.createElement("DIV");
            l.className = "divider", n.appendChild(l), i("clear", t.clearIcon, "移除所有元素", function () {
                s.primitives.removeAll()
            }), c(this)
        }

        return e
    }(), e.prototype.addToolbar = function (t, i) {
        return i = s(i, {container: t}), new e.DrawHelperWidget(this, i)
    }, e.prototype.startDrawElement = function (e, t) {
        _self = this;
        var i = Cesium.Material.fromType(Cesium.Material.ColorType);
        i.uniforms.color = new Cesium.Color(1, 0, 0, .5), "polygon" == e && this.startDrawingPolygon({
            callback: function (e) {
                var r = new DrawElement.PolygonPrimitive({positions: e, material: i});
                _self._scene.primitives.add(r), r.setEditable(), r.addListener("onEdited", function (e) {
                    "function" == typeof t && t(e.positions)
                }), "function" == typeof t && t(e)
            }
        })
    }, e.prototype.clearDrawElement = function () {
        this._scene.primitives.removeAll()
    }, e
}(), defaultCreditgoogle = new Cesium.Credit("googlemap"), GoogleMapImageProvider = function (e) {
    e = Cesium.defaultValue(e, {}), this._isHistoryImage = Cesium.defaultValue(e.isHistoryImage, !1), this._imageVersion = Cesium.defaultValue(e.imageVersion, "0");
    var t = Cesium.defaultValue(e.url, "http://mt{s}.google.cn/vt/v=w2.114&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}&s="), i = "";
    this._url = t + i, this._imageInfoUrl = this._url, this._tileDiscardPolicy = e.tileDiscardPolicy, this._tilingScheme = new Cesium.WebMercatorTilingScheme({
        numberOfLevelZeroTilesX: 1,
        numberOfLevelZeroTilesY: 1,
        rectangleSouthwestInMeters: new Cesium.Cartesian2((-20037508.342789244), (-20037508.342789244)),
        rectangleNortheastInMeters: new Cesium.Cartesian2(20037508.342789244, 20037508.342789244)
    }), this._tileWidth = 256, this._tileHeight = 256, this._enablePickFeatures = Cesium.defaultValue(e.enablePickFeatures, !0), this._minimumLevel = Cesium.defaultValue(e.minimumLevel, 0), this._maximumLevel = Cesium.defaultValue(e.maximumLevel, 19), this._rectangle = Cesium.defaultValue(e.rectangle, this._tilingScheme.rectangle);
    var r = this._tilingScheme.positionToTileXY(Cesium.Rectangle.southwest(this._rectangle), this._minimumLevel), o = this._tilingScheme.positionToTileXY(Cesium.Rectangle.northeast(this._rectangle), this._minimumLevel), n = (Math.abs(o.x - r.x) + 1) * (Math.abs(o.y - r.y) + 1);
    if (n > 4)throw new Cesium.DeveloperError("The imagery provider's rectangle and minimumLevel indicate that there are " + n + " tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.");
    this._errorEvent = new Cesium.Event, this._ready = !0;
    var a = Cesium.defaultValue(e.credit, defaultCreditgoogle);
    "string" == typeof a && (a = new Cesium.Credit(a)), this._credit = a, this._imageDate = {tileKey: "", date: ""}
};
GoogleMapImageProvider.prototype.buildImageUrl = function (e, t, i, r) {
    var o = e._url;
    return o = o.replace("{s}", (t + i) % 4), o = o.replace("{x}", t), o = o.replace("{y}", i), o = o.replace("{z}", r)
}, Cesium.defineProperties(GoogleMapImageProvider.prototype, {
    url: {
        get: function () {
            return this._url
        }
    }, tileWidth: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tileWidth must not be called before the imagery provider is ready.");
            return this._tileWidth
        }
    }, tileHeight: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tileHeight must not be called before the imagery provider is ready.");
            return this._tileHeight
        }
    }, maximumLevel: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("maximumLevel must not be called before the imagery provider is ready.");
            return this._maximumLevel
        }
    }, minimumLevel: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("minimumLevel must not be called before the imagery provider is ready.");
            return this._minimumLevel
        }
    }, tilingScheme: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tilingScheme must not be called before the imagery provider is ready.");
            return this._tilingScheme
        }
    }, rectangle: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("rectangle must not be called before the imagery provider is ready.");
            return this._rectangle
        }
    }, tileDiscardPolicy: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.");
            return this._tileDiscardPolicy
        }
    }, errorEvent: {
        get: function () {
            return this._errorEvent
        }
    }, ready: {
        get: function () {
            return this._ready
        }
    }, credit: {
        get: function () {
            return this._credit
        }
    }, hasAlphaChannel: {
        get: function () {
            return !0
        }
    }
}), GoogleMapImageProvider.prototype.getTileCredits = function (e, t, i) {
}, GoogleMapImageProvider.prototype.requestImage = function (e, t, i) {
    if (!this._ready)throw new Cesium.DeveloperError("requestImage must not be called before the imagery provider is ready.");
    var r = this.buildImageUrl(this, e, t, i), o = Cesium.ImageryProvider.loadImage(this, r);
    return o
}, GoogleMapImageProvider.prototype.pickFeatures = function (e, t, i, r, o) {
    if (!this._ready)throw new Cesium.DeveloperError("pickFeatures must not be called before the imagery provider is ready.");
    if (this._enablePickFeatures) {
        var n = this._imageInfoUrl.replace("{s}", (e + t) % 4);
        return n = n.replace("{x}", t), n = n.replace("{y}", e), n = n.replace("{z}", i), this._isHistoryImage && (n = n.replace("{version}", this._imageVersion)), Cesium.when(Cesium.loadJson(n), function (e) {
            var t = [], i = new Cesium.ImageryLayerFeatureInfo;
            return i.data = e, i.name = "imgInfo", t.push(i), t
        })
    }
};
var defaultCreditZondy = new Cesium.Credit("MapGISMap"), MapGISDocMapProvider = function (e) {
    e = Cesium.defaultValue(e, {}), this._isHistoryImage = Cesium.defaultValue(e.isHistoryImage, !1), this._imageVersion = Cesium.defaultValue(e.imageVersion, "0");
    var t = Cesium.defaultValue(e.url, "http://localhost:6163/igs/rest/mrms/tile/QUANQIU_180_ZC/{level}/{row}/{col}"), i = "";
    this._colNum = Cesium.defaultValue(e.colNum, 2), this._rowNum = Cesium.defaultValue(e.rowNum, 1);
    var r = Cesium.Rectangle.fromDegrees(-180, -90, 180, 90);
    void 0 != e.rectangle && (r = e.rectangle), this._url = t + i, this._proxy = e.proxy, this._imageInfoUrl = this._url, void 0 == e.tilingScheme ? this._tilingScheme = new Cesium.GeographicTilingScheme({
        rectangle: r,
        ellipsoid: Cesium.Ellipsoid.WGS84,
        numberOfLevelZeroTilesX: this._colNum,
        numberOfLevelZeroTilesY: this._rowNum
    }) : this._tilingScheme = e.tilingScheme, this._tileDiscardPolicy = e.tileDiscardPolicy, this._tileWidth = 256, this._tileHeight = 256, this._enablePickFeatures = Cesium.defaultValue(e.enablePickFeatures, !1), this._minimumLevel = Cesium.defaultValue(e.minimumLevel, 0), this._maximumLevel = Cesium.defaultValue(e.maximumLevel, 19), this._rectangle = Cesium.defaultValue(e.rectangle, this._tilingScheme.rectangle);
    var o = this._tilingScheme.positionToTileXY(Cesium.Rectangle.southwest(this._rectangle), this._minimumLevel), n = this._tilingScheme.positionToTileXY(Cesium.Rectangle.northeast(this._rectangle), this._minimumLevel);
    (Math.abs(n.x - o.x) + 1) * (Math.abs(n.y - o.y) + 1);
    this._errorEvent = new Cesium.Event, this._ready = !0;
    var a = Cesium.defaultValue(e.credit, defaultCreditZondy);
    "string" == typeof a && (a = new Cesium.Credit(a)), this._credit = a, this._imageDate = {tileKey: "", date: ""}
};
MapGISDocMapProvider.prototype.buildImageUrl = function (e, t, i, r) {
    var o = e._url;
    return i = 3 * Math.pow(2, r) - 1 - i, o = o.replace("{s}", (t + i) % 4), o = o.replace("{row}", i), o = o.replace("{col}", t), o = o.replace("{level}", r)
}, Cesium.defineProperties(MapGISDocMapProvider.prototype, {
    url: {
        get: function () {
            return this._url
        }
    }, proxy: {
        get: function () {
            return this._proxy
        }
    }, tileWidth: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tileWidth must not be called before the imagery provider is ready.");
            return this._tileWidth
        }
    }, tileHeight: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tileHeight must not be called before the imagery provider is ready.");
            return this._tileHeight
        }
    }, maximumLevel: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("maximumLevel must not be called before the imagery provider is ready.");
            return this._maximumLevel
        }
    },
    minimumLevel: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("minimumLevel must not be called before the imagery provider is ready.");
            return this._minimumLevel
        }
    }, tilingScheme: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tilingScheme must not be called before the imagery provider is ready.");
            return this._tilingScheme
        }
    }, rectangle: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("rectangle must not be called before the imagery provider is ready.");
            return this._rectangle
        }
    }, tileDiscardPolicy: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.");
            return this._tileDiscardPolicy
        }
    }, errorEvent: {
        get: function () {
            return this._errorEvent
        }
    }, ready: {
        get: function () {
            return this._ready
        }
    }, credit: {
        get: function () {
            return this._credit
        }
    }, hasAlphaChannel: {
        get: function () {
            return !0
        }
    }
}), MapGISDocMapProvider.prototype.getTileCredits = function (e, t, i) {
}, MapGISDocMapProvider.prototype.requestImage = function (e, t, i) {
    if (!this._ready)throw new Cesium.DeveloperError("requestImage must not be called before the imagery provider is ready.");
    var r = this.buildImageUrl(this, e, t, i), o = Cesium.ImageryProvider.loadImage(this, r);
    return o
}, MapGISDocMapProvider.prototype.pickFeatures = function (e, t, i, r, o) {
    if (!this._ready)throw new Cesium.DeveloperError("pickFeatures must not be called before the imagery provider is ready.");
    if (this._enablePickFeatures) {
        var n = this._imageInfoUrl.replace("{s}", (e + t) % 4);
        return t = 3 * Math.pow(2, i) - 1 - t, n = n.replace("{s}", (e + t) % 4), n = n.replace("{row}", t), n = n.replace("{col}", e), n = n.replace("{level}", i), this._isHistoryImage && (n = n.replace("{version}", this._imageVersion)), Cesium.when(Cesium.loadJson(n), function (e) {
            var t = [], i = new Cesium.ImageryLayerFeatureInfo;
            return i.data = e, i.name = "imgInfo", t.push(i), t
        })
    }
};
var defaultCreditZondy = new Cesium.Credit("MapGISMap"), MapGISMapImageProvider = function (e) {
    e = Cesium.defaultValue(e, {}), this._isHistoryImage = Cesium.defaultValue(e.isHistoryImage, !1), this._imageVersion = Cesium.defaultValue(e.imageVersion, "0");
    var t = Cesium.defaultValue(e.url, "http://localhost:6163/igs/rest/mrms/tile/QUANQIU_180_ZC/{level}/{row}/{col}"), i = "";
    this._colNum = Cesium.defaultValue(e.colNum, 2), this._rowNum = Cesium.defaultValue(e.rowNum, 1);
    var r = Cesium.Rectangle.fromDegrees(-180, -90, 180, 90);
    void 0 != e.rectangle && (r = e.rectangle), this._url = t + i, this._proxy = e.proxy, this._imageInfoUrl = this._url, void 0 == e.tilingScheme ? this._tilingScheme = new Cesium.GeographicTilingScheme({
        rectangle: r,
        ellipsoid: Cesium.Ellipsoid.WGS84,
        numberOfLevelZeroTilesX: this._colNum,
        numberOfLevelZeroTilesY: this._rowNum
    }) : this._tilingScheme = e.tilingScheme, this._tileDiscardPolicy = e.tileDiscardPolicy, this._tileWidth = 256, this._tileHeight = 256, this._enablePickFeatures = Cesium.defaultValue(e.enablePickFeatures, !1), this._minimumLevel = Cesium.defaultValue(e.minimumLevel, 0), this._maximumLevel = Cesium.defaultValue(e.maximumLevel, 9), this._rectangle = Cesium.defaultValue(e.rectangle, this._tilingScheme.rectangle);
    var o = this._tilingScheme.positionToTileXY(Cesium.Rectangle.southwest(this._rectangle), this._minimumLevel), n = this._tilingScheme.positionToTileXY(Cesium.Rectangle.northeast(this._rectangle), this._minimumLevel);
    (Math.abs(n.x - o.x) + 1) * (Math.abs(n.y - o.y) + 1);
    this._errorEvent = new Cesium.Event, this._ready = !0;
    var a = Cesium.defaultValue(e.credit, defaultCreditZondy);
    "string" == typeof a && (a = new Cesium.Credit(a)), this._credit = a, this._imageDate = {tileKey: "", date: ""}
};
MapGISMapImageProvider.prototype.buildImageUrl = function (e, t, i, r) {
    var o = e._url;
    return o = o.replace("{row}", i), o = o.replace("{col}", t), o = o.replace("{level}", r)
}, Cesium.defineProperties(MapGISMapImageProvider.prototype, {
    url: {
        get: function () {
            return this._url
        }
    }, proxy: {
        get: function () {
            return this._proxy
        }
    }, tileWidth: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tileWidth must not be called before the imagery provider is ready.");
            return this._tileWidth
        }
    }, tileHeight: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tileHeight must not be called before the imagery provider is ready.");
            return this._tileHeight
        }
    }, maximumLevel: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("maximumLevel must not be called before the imagery provider is ready.");
            return this._maximumLevel
        }
    }, minimumLevel: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("minimumLevel must not be called before the imagery provider is ready.");
            return this._minimumLevel
        }
    }, tilingScheme: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tilingScheme must not be called before the imagery provider is ready.");
            return this._tilingScheme
        }
    }, rectangle: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("rectangle must not be called before the imagery provider is ready.");
            return this._rectangle
        }
    }, tileDiscardPolicy: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.");
            return this._tileDiscardPolicy
        }
    }, errorEvent: {
        get: function () {
            return this._errorEvent
        }
    }, ready: {
        get: function () {
            return this._ready
        }
    }, credit: {
        get: function () {
            return this._credit
        }
    }, hasAlphaChannel: {
        get: function () {
            return !0
        }
    }
}), MapGISMapImageProvider.prototype.getTileCredits = function (e, t, i) {
}, MapGISMapImageProvider.prototype.requestImage = function (e, t, i) {
    if (!this._ready)throw new Cesium.DeveloperError("requestImage must not be called before the imagery provider is ready.");
    var r = this.buildImageUrl(this, e, t, i), o = Cesium.ImageryProvider.loadImage(this, r);
    return o
}, MapGISMapImageProvider.prototype.pickFeatures = function (e, t, i, r, o) {
    if (!this._ready)throw new Cesium.DeveloperError("pickFeatures must not be called before the imagery provider is ready.");
    if (this._enablePickFeatures) {
        var n = this._imageInfoUrl.replace("{s}", (e + t) % 4);
        return n = n.replace("{row}", t), n = n.replace("{col}", e), n = n.replace("{level}", i), this._isHistoryImage && (n = n.replace("{version}", this._imageVersion)), Cesium.when(Cesium.loadJson(n), function (e) {
            var t = [], i = new Cesium.ImageryLayerFeatureInfo;
            return i.data = e, i.name = "imgInfo", t.push(i), t
        })
    }
}, GASProjection.aEarth = 6378137, GASProjection.bEarth = 6356752.3142, GASProjection.e1 = Math.sqrt(GASProjection.aEarth * GASProjection.aEarth - GASProjection.bEarth * GASProjection.bEarth) / GASProjection.aEarth, GASProjection.e2 = Math.sqrt(GASProjection.aEarth * GASProjection.aEarth - GASProjection.bEarth * GASProjection.bEarth) / GASProjection.bEarth, GASProjection.to_Radian = function (e) {
    return e / 180 * Math.PI
}, GASProjection.to_Sm = function (e) {
    var t, i, r, o, n;
    return t = 1 + GASProjection.e1 * GASProjection.e1 * 3 / 4 + 45 * Math.pow(GASProjection.e1, 4) / 64 + 175 * Math.pow(GASProjection.e1, 6) / 256 + 11025 * Math.pow(GASProjection.e1, 8) / 16384, i = 3 * Math.pow(GASProjection.e1, 2) / 4 + 15 * Math.pow(GASProjection.e1, 4) / 16 + 525 * Math.pow(GASProjection.e1, 6) / 512 + 2205 * Math.pow(GASProjection.e1, 8) / 2048, r = 15 * Math.pow(GASProjection.e1, 4) / 64 + 105 * Math.pow(GASProjection.e1, 6) / 256 + 2205 * Math.pow(GASProjection.e1, 8) / 4096, o = 35 * Math.pow(GASProjection.e1, 6) / 512 + 315 * Math.pow(GASProjection.e1, 8) / 2048, n = 315 * Math.pow(GASProjection.e1, 8) / 16384, GASProjection.aEarth * (1 - GASProjection.e1 * GASProjection.e1) * (t * e - i / 2 * Math.sin(2 * e) + r / 4 * Math.sin(4 * e) - o / 6 * Math.sin(6 * e) + n / 8 * Math.sin(8 * e))
}, GASProjection.to_N = function (e) {
    var t = GASProjection.aEarth / Math.sqrt(1 - GASProjection.e1 * GASProjection.e1 * Math.sin(e) * Math.sin(e));
    return t
}, GASProjection.Gauss_to_XY = function (e, t, i) {
    var r = 0, o = 0, n = 0, a = 0, s = GASProjection.to_Radian(i);
    t = GASProjection.to_Radian(t), e = GASProjection.to_Radian(e);
    var l = e - s, c = Math.cos(t);
    a = GASProjection.to_N(t), n = a * Math.cos(t), r = Math.tan(t), o = GASProjection.e2 * c;
    var h = Math.pow(r, 2), u = Math.pow(r, 4), d = Math.pow(o, 2), p = Math.pow(o, 4), m = Math.pow(c, 3), g = Math.pow(c, 5), f = GASProjection.to_Sm(t) + Math.pow(l, 2) / 2 * n * c * r + Math.pow(l, 4) / 24 * r * n * m * (5 - h + 9 * d + 4 * p) + Math.pow(l, 6) / 720 * r * n * g * (61 - 58 * r * r + u + 270 * d - 330 * r * r * d), v = l * a * c + Math.pow(l, 3) / 6 * a * m * (1 - r * r + o * o) + Math.pow(l, 5) / 120 * a * g * (5 - 18 * r * r + u + 14 * d - 58 * d * h);
    return new Cesium.Cartesian2(v, f)
}, GASProjection.Sm_to_B = function (e) {
    var t, i, r, o, n, a, s, l, c, h, u, d, p, m, g;
    return s = 1 + GASProjection.e1 * GASProjection.e1 * 3 / 4 + 45 * Math.pow(GASProjection.e1, 4) / 64 + 175 * Math.pow(GASProjection.e1, 6) / 256 + 11025 * Math.pow(GASProjection.e1, 8) / 16384, l = 3 * Math.pow(GASProjection.e1, 2) / 4 + 15 * Math.pow(GASProjection.e1, 4) / 16 + 525 * Math.pow(GASProjection.e1, 6) / 512 + 2205 * Math.pow(GASProjection.e1, 8) / 2048, c = 15 * Math.pow(GASProjection.e1, 4) / 64 + 105 * Math.pow(GASProjection.e1, 6) / 256 + 2205 * Math.pow(GASProjection.e1, 8) / 4096, h = 35 * Math.pow(GASProjection.e1, 6) / 512 + 315 * Math.pow(GASProjection.e1, 8) / 2048, u = 315 * Math.pow(GASProjection.e1, 8) / 16384, a = e / (GASProjection.aEarth * (1 - GASProjection.e1 * GASProjection.e1) * s), d = l / s / 2, p = -c / s / 4, m = h / s / 6, g = -u / s / 8, i = d - d * p - p * m - .5 * Math.pow(d, 3) - d * Math.pow(p, 2) + .5 * Math.pow(d, 2) * m - 18.3 * Math.pow(d, 3) * p, r = p + Math.pow(d, 2) - d * m * 2 - 4 * d * d * p - 1.3 * Math.pow(d, 4), o = m + 3 * d * p - 3 * d * g + 1.5 * Math.pow(d, 3) - 4.5 * d * p * p - 9 * d * d * m - 12.5 * Math.pow(d, 3) * p, n = g + 2 * p * p + 4 * d * m + 8 * d * d * p + 2.7 * Math.pow(d, 4), t = a + i * Math.sin(2 * a) + r * Math.sin(4 * a) + o * Math.sin(6 * a) + n * Math.sin(8 * a)
}, GASProjection.Gauss_to_BL = function (e, t, i) {
    var r, o, n, a;
    r = GASProjection.Sm_to_B(t), o = GASProjection.to_N(r), n = Math.tan(r), a = GASProjection.e2 * Math.cos(r);
    var s = r + n * (-1 - a * a) * e * e / (2 * Math.pow(o, 2)) + n * (5 + 3 * Math.pow(n, 2) + 6 * Math.pow(a, 2) - 6 * Math.pow(n, 2) * Math.pow(a, 2) - 3 * Math.pow(a, 4) - 9 * Math.pow(n, 2) * Math.pow(a, 4)) * Math.pow(e, 4) / (24 * Math.pow(o, 4)) + n * (-61 - 90 * Math.pow(n, 2) - 45 * Math.pow(n, 4) - 107 * Math.pow(a, 2) + 162 * Math.pow(n, 2) * Math.pow(a, 2) + 45 * Math.pow(n, 4) * Math.pow(a, 2)) * Math.pow(e, 6) / (720 * Math.pow(o, 6)), l = e / (o * Math.cos(r)) + (-1 - 2 * Math.pow(n, 2) - Math.pow(a, 2)) * Math.pow(e, 3) / (6 * Math.pow(o, 3) * Math.cos(r)) + (5 + 28 * Math.pow(n, 2) + 24 * Math.pow(n, 4) + 6 * Math.pow(a, 2) + 8 * Math.pow(n, 2) * Math.pow(a, 2)) * Math.pow(e, 5) / (120 * Math.pow(o, 5) * Math.cos(r)), c = new Object;
    return c.longitude = l / Math.PI * 180 + i, c.latitude = s / Math.PI * 180, c
}, GASProjection.to_Degree = function (e) {
    return e / Math.PI * 180
}, window.ReImg = {
    OutputProcessor: function (e, t) {
        var i = function () {
            return 0 === e.indexOf("data:image/png")
        }, r = function (e, t) {
            var i = document.createElement("a");
            i.href = e, i.download = t, document.body.appendChild(i), i.click()
        };
        return {
            toBase64: function () {
                return e
            }, toImg: function () {
                var t = document.createElement("img");
                return t.src = e, t
            }, toCanvas: function (e) {
                var i = document.createElement("canvas"), r = t.getBoundingClientRect();
                i.width = r.width, i.height = r.height;
                var o = i.getContext("2d"), n = this.toImg();
                n.onload = function () {
                    o.drawImage(n, 0, 0), e(i)
                }
            }, toPng: function () {
                if (i()) {
                    var t = document.createElement("img");
                    return t.src = e, t
                }
                this.toCanvas(function (e) {
                    var t = document.createElement("img");
                    return t.src = e.toDataURL(), t
                })
            }, toJpeg: function (e) {
                e = e || 1, function (e) {
                    this.toCanvas(function (t) {
                        var i = document.createElement("img");
                        return i.src = t.toDataURL("image/jpeg", e), i
                    })
                }(e)
            }, downloadPng: function (t) {
                return t = t || "image.png", i() ? void r(e, t) : void this.toCanvas(function (e) {
                    r(e.toDataURL(), t)
                })
            }
        }
    }, fromSvg: function (e) {
        var t = (new XMLSerializer).serializeToString(e);
        return new this.OutputProcessor("data:image/svg+xml;base64," + window.btoa(t), e)
    }, fromCanvas: function (e) {
        var t = e.toDataURL();
        return new this.OutputProcessor(t)
    }
};
var defaultCreditTianditu = new Cesium.Credit("天地图"), TiandituMapImageProvider = function (e) {
    e = Cesium.defaultValue(e, {}), this._isHistoryImage = Cesium.defaultValue(e.isHistoryImage, !1), this._imageVersion = Cesium.defaultValue(e.imageVersion, "0");
    var t = Cesium.defaultValue(e.url, "http://t0.tianditu.cn/DataServer?T=cia_c&X={x}&Y={y}&L={l}"), i = "";
    this._url = t + i, this._imageInfoUrl = this._url, this._tileDiscardPolicy = e.tileDiscardPolicy, this._tilingScheme = new Cesium.GeographicTilingScheme({
        rectangle: Cesium.Rectangle.fromDegrees(-180, -90, 180, 90),
        ellipsoid: Cesium.Ellipsoid.WGS84,
        numberOfLevelZeroTilesX: 2,
        numberOfLevelZeroTilesY: 1
    }), this._tileWidth = 256, this._tileHeight = 256, this._enablePickFeatures = Cesium.defaultValue(e.enablePickFeatures, !0), this._minimumLevel = Cesium.defaultValue(e.minimumLevel, 0), this._maximumLevel = Cesium.defaultValue(e.maximumLevel, 19), this._rectangle = Cesium.defaultValue(e.rectangle, this._tilingScheme.rectangle);
    var r = this._tilingScheme.positionToTileXY(Cesium.Rectangle.southwest(this._rectangle), this._minimumLevel), o = this._tilingScheme.positionToTileXY(Cesium.Rectangle.northeast(this._rectangle), this._minimumLevel), n = (Math.abs(o.x - r.x) + 1) * (Math.abs(o.y - r.y) + 1);
    if (n > 4)throw new Cesium.DeveloperError("The imagery provider's rectangle and minimumLevel indicate that there are " + n + " tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.");
    this._errorEvent = new Cesium.Event, this._ready = !0;
    var a = Cesium.defaultValue(e.credit, defaultCreditTianditu);
    "string" == typeof a && (a = new Cesium.Credit(a)), this._credit = a, this._imageDate = {tileKey: "", date: ""}
};
TiandituMapImageProvider.prototype.buildImageUrl = function (e, t, i, r) {
    var o = e._url;
    return r += 1, o = o.replace("{s}", (t + i) % 4), o = o.replace("{x}", t), o = o.replace("{y}", i), o = o.replace("{l}", r)
}, Cesium.defineProperties(TiandituMapImageProvider.prototype, {
    url: {
        get: function () {
            return this._url
        }
    }, tileWidth: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tileWidth must not be called before the imagery provider is ready.");
            return this._tileWidth
        }
    }, tileHeight: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tileHeight must not be called before the imagery provider is ready.");
            return this._tileHeight
        }
    }, maximumLevel: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("maximumLevel must not be called before the imagery provider is ready.");
            return this._maximumLevel
        }
    }, minimumLevel: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("minimumLevel must not be called before the imagery provider is ready.");
            return this._minimumLevel
        }
    }, tilingScheme: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tilingScheme must not be called before the imagery provider is ready.");
            return this._tilingScheme
        }
    }, rectangle: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("rectangle must not be called before the imagery provider is ready.");
            return this._rectangle
        }
    }, tileDiscardPolicy: {
        get: function () {
            if (!this._ready)throw new Cesium.DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.");
            return this._tileDiscardPolicy
        }
    }, errorEvent: {
        get: function () {
            return this._errorEvent
        }
    }, ready: {
        get: function () {
            return this._ready
        }
    }, credit: {
        get: function () {
            return this._credit
        }
    }, hasAlphaChannel: {
        get: function () {
            return !0
        }
    }
}), TiandituMapImageProvider.prototype.getTileCredits = function (e, t, i) {
}, TiandituMapImageProvider.prototype.requestImage = function (e, t, i) {
    if (!this._ready)throw new Cesium.DeveloperError("requestImage must not be called before the imagery provider is ready.");
    var r = this.buildImageUrl(this, e, t, i), o = Cesium.ImageryProvider.loadImage(this, r);
    return o
}, TiandituMapImageProvider.prototype.pickFeatures = function (e, t, i, r, o) {
    if (!this._ready)throw new Cesium.DeveloperError("pickFeatures must not be called before the imagery provider is ready.");
    if (this._enablePickFeatures) {
        var n = this._imageInfoUrl.replace("{s}", (e + t) % 4);
        return t = Math.pow(2, i) - t, n = n.replace("{x}", e), n = n.replace("{y}", t), n = n.replace("{l}", i), this._isHistoryImage && (n = n.replace("{version}", this._imageVersion)), Cesium.when(Cesium.loadJson(n), function (e) {
            var t = [], i = new Cesium.ImageryLayerFeatureInfo;
            return i.data = e, i.name = "imgInfo", t.push(i), t
        })
    }
};